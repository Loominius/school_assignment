<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Ini Judul</title>
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <style>
        img {
            width: 150px;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="col-md-6 col-md-offset-3">
            <div class="row">
                <div class="panel panel-default" style="margin-top: 100px">
                    <div class="panel-heading">
                        <h3 class="text-center">
                            Belajar jQuery
                        </h3>
                    </div>
                    <div class="panel-body text-center">
                        <h4>Belajar jQuery Traversing</h4>
                        <ul>
                            <li>List Item</li>
                            <li>List Item</li>
                            <li>List Item</li>
                            <li>List Item</li>
                        </ul>
                        <button class="btn btn-default btn-action">
                            slideUp
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="assets/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="data:application/octet-stream;base64,LyohCiAqIEJvb3RzdHJhcCB2My4zLjUgKGh0dHA6Ly9nZXRib290c3RyYXAuY29tKQogKiBDb3B5cmlnaHQgMjAxMS0yMDE1IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqLwoKaWYgKHR5cGVvZiBqUXVlcnkgPT09ICd1bmRlZmluZWQnKSB7CiAgdGhyb3cgbmV3IEVycm9yKCdCb290c3RyYXBcJ3MgSmF2YVNjcmlwdCByZXF1aXJlcyBqUXVlcnknKQp9CgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0cmljdCc7CiAgdmFyIHZlcnNpb24gPSAkLmZuLmpxdWVyeS5zcGxpdCgnICcpWzBdLnNwbGl0KCcuJykKICBpZiAoKHZlcnNpb25bMF0gPCAyICYmIHZlcnNpb25bMV0gPCA5KSB8fCAodmVyc2lvblswXSA9PSAxICYmIHZlcnNpb25bMV0gPT0gOSAmJiB2ZXJzaW9uWzJdIDwgMSkpIHsKICAgIHRocm93IG5ldyBFcnJvcignQm9vdHN0cmFwXCdzIEphdmFTY3JpcHQgcmVxdWlyZXMgalF1ZXJ5IHZlcnNpb24gMS45LjEgb3IgaGlnaGVyJykKICB9Cn0oalF1ZXJ5KTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBCb290c3RyYXA6IHRyYW5zaXRpb24uanMgdjMuMy41CiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI3RyYW5zaXRpb25zCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQgMjAxMS0yMDE1IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgoKK2Z1bmN0aW9uICgkKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBDU1MgVFJBTlNJVElPTiBTVVBQT1JUIChTaG91dG91dDogaHR0cDovL3d3dy5tb2Rlcm5penIuY29tLykKICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgZnVuY3Rpb24gdHJhbnNpdGlvbkVuZCgpIHsKICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Jvb3RzdHJhcCcpCgogICAgdmFyIHRyYW5zRW5kRXZlbnROYW1lcyA9IHsKICAgICAgV2Via2l0VHJhbnNpdGlvbiA6ICd3ZWJraXRUcmFuc2l0aW9uRW5kJywKICAgICAgTW96VHJhbnNpdGlvbiAgICA6ICd0cmFuc2l0aW9uZW5kJywKICAgICAgT1RyYW5zaXRpb24gICAgICA6ICdvVHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCcsCiAgICAgIHRyYW5zaXRpb24gICAgICAgOiAndHJhbnNpdGlvbmVuZCcKICAgIH0KCiAgICBmb3IgKHZhciBuYW1lIGluIHRyYW5zRW5kRXZlbnROYW1lcykgewogICAgICBpZiAoZWwuc3R5bGVbbmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB7IGVuZDogdHJhbnNFbmRFdmVudE5hbWVzW25hbWVdIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZSAvLyBleHBsaWNpdCBmb3IgaWU4ICggIC5fLikKICB9CgogIC8vIGh0dHA6Ly9ibG9nLmFsZXhtYWNjYXcuY29tL2Nzcy10cmFuc2l0aW9ucwogICQuZm4uZW11bGF0ZVRyYW5zaXRpb25FbmQgPSBmdW5jdGlvbiAoZHVyYXRpb24pIHsKICAgIHZhciBjYWxsZWQgPSBmYWxzZQogICAgdmFyICRlbCA9IHRoaXMKICAgICQodGhpcykub25lKCdic1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7IGNhbGxlZCA9IHRydWUgfSkKICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHsgaWYgKCFjYWxsZWQpICQoJGVsKS50cmlnZ2VyKCQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCkgfQogICAgc2V0VGltZW91dChjYWxsYmFjaywgZHVyYXRpb24pCiAgICByZXR1cm4gdGhpcwogIH0KCiAgJChmdW5jdGlvbiAoKSB7CiAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiA9IHRyYW5zaXRpb25FbmQoKQoKICAgIGlmICghJC5zdXBwb3J0LnRyYW5zaXRpb24pIHJldHVybgoKICAgICQuZXZlbnQuc3BlY2lhbC5ic1RyYW5zaXRpb25FbmQgPSB7CiAgICAgIGJpbmRUeXBlOiAkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsCiAgICAgIGRlbGVnYXRlVHlwZTogJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLAogICAgICBoYW5kbGU6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKCQoZS50YXJnZXQpLmlzKHRoaXMpKSByZXR1cm4gZS5oYW5kbGVPYmouaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgIH0KICB9KQoKfShqUXVlcnkpOwoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIEJvb3RzdHJhcDogYWxlcnQuanMgdjMuMy41CiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI2FsZXJ0cwogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQ29weXJpZ2h0IDIwMTEtMjAxNSBUd2l0dGVyLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKCitmdW5jdGlvbiAoJCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLy8gQUxFUlQgQ0xBU1MgREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT0KCiAgdmFyIGRpc21pc3MgPSAnW2RhdGEtZGlzbWlzcz0iYWxlcnQiXScKICB2YXIgQWxlcnQgICA9IGZ1bmN0aW9uIChlbCkgewogICAgJChlbCkub24oJ2NsaWNrJywgZGlzbWlzcywgdGhpcy5jbG9zZSkKICB9CgogIEFsZXJ0LlZFUlNJT04gPSAnMy4zLjUnCgogIEFsZXJ0LlRSQU5TSVRJT05fRFVSQVRJT04gPSAxNTAKCiAgQWxlcnQucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKGUpIHsKICAgIHZhciAkdGhpcyAgICA9ICQodGhpcykKICAgIHZhciBzZWxlY3RvciA9ICR0aGlzLmF0dHIoJ2RhdGEtdGFyZ2V0JykKCiAgICBpZiAoIXNlbGVjdG9yKSB7CiAgICAgIHNlbGVjdG9yID0gJHRoaXMuYXR0cignaHJlZicpCiAgICAgIHNlbGVjdG9yID0gc2VsZWN0b3IgJiYgc2VsZWN0b3IucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCAnJykgLy8gc3RyaXAgZm9yIGllNwogICAgfQoKICAgIHZhciAkcGFyZW50ID0gJChzZWxlY3RvcikKCiAgICBpZiAoZSkgZS5wcmV2ZW50RGVmYXVsdCgpCgogICAgaWYgKCEkcGFyZW50Lmxlbmd0aCkgewogICAgICAkcGFyZW50ID0gJHRoaXMuY2xvc2VzdCgnLmFsZXJ0JykKICAgIH0KCiAgICAkcGFyZW50LnRyaWdnZXIoZSA9ICQuRXZlbnQoJ2Nsb3NlLmJzLmFsZXJ0JykpCgogICAgaWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybgoKICAgICRwYXJlbnQucmVtb3ZlQ2xhc3MoJ2luJykKCiAgICBmdW5jdGlvbiByZW1vdmVFbGVtZW50KCkgewogICAgICAvLyBkZXRhY2ggZnJvbSBwYXJlbnQsIGZpcmUgZXZlbnQgdGhlbiBjbGVhbiB1cCBkYXRhCiAgICAgICRwYXJlbnQuZGV0YWNoKCkudHJpZ2dlcignY2xvc2VkLmJzLmFsZXJ0JykucmVtb3ZlKCkKICAgIH0KCiAgICAkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiAkcGFyZW50Lmhhc0NsYXNzKCdmYWRlJykgPwogICAgICAkcGFyZW50CiAgICAgICAgLm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgcmVtb3ZlRWxlbWVudCkKICAgICAgICAuZW11bGF0ZVRyYW5zaXRpb25FbmQoQWxlcnQuVFJBTlNJVElPTl9EVVJBVElPTikgOgogICAgICByZW1vdmVFbGVtZW50KCkKICB9CgoKICAvLyBBTEVSVCBQTFVHSU4gREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhICA9ICR0aGlzLmRhdGEoJ2JzLmFsZXJ0JykKCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuYWxlcnQnLCAoZGF0YSA9IG5ldyBBbGVydCh0aGlzKSkpCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0uY2FsbCgkdGhpcykKICAgIH0pCiAgfQoKICB2YXIgb2xkID0gJC5mbi5hbGVydAoKICAkLmZuLmFsZXJ0ICAgICAgICAgICAgID0gUGx1Z2luCiAgJC5mbi5hbGVydC5Db25zdHJ1Y3RvciA9IEFsZXJ0CgoKICAvLyBBTEVSVCBOTyBDT05GTElDVAogIC8vID09PT09PT09PT09PT09PT09CgogICQuZm4uYWxlcnQubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQuZm4uYWxlcnQgPSBvbGQKICAgIHJldHVybiB0aGlzCiAgfQoKCiAgLy8gQUxFUlQgREFUQS1BUEkKICAvLyA9PT09PT09PT09PT09PQoKICAkKGRvY3VtZW50KS5vbignY2xpY2suYnMuYWxlcnQuZGF0YS1hcGknLCBkaXNtaXNzLCBBbGVydC5wcm90b3R5cGUuY2xvc2UpCgp9KGpRdWVyeSk7CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQm9vdHN0cmFwOiBidXR0b24uanMgdjMuMy41CiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI2J1dHRvbnMKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvcHlyaWdodCAyMDExLTIwMTUgVHdpdHRlciwgSW5jLgogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIEJVVFRPTiBQVUJMSUMgQ0xBU1MgREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICB2YXIgQnV0dG9uID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMuJGVsZW1lbnQgID0gJChlbGVtZW50KQogICAgdGhpcy5vcHRpb25zICAgPSAkLmV4dGVuZCh7fSwgQnV0dG9uLkRFRkFVTFRTLCBvcHRpb25zKQogICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZQogIH0KCiAgQnV0dG9uLlZFUlNJT04gID0gJzMuMy41JwoKICBCdXR0b24uREVGQVVMVFMgPSB7CiAgICBsb2FkaW5nVGV4dDogJ2xvYWRpbmcuLi4nCiAgfQoKICBCdXR0b24ucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24gKHN0YXRlKSB7CiAgICB2YXIgZCAgICA9ICdkaXNhYmxlZCcKICAgIHZhciAkZWwgID0gdGhpcy4kZWxlbWVudAogICAgdmFyIHZhbCAgPSAkZWwuaXMoJ2lucHV0JykgPyAndmFsJyA6ICdodG1sJwogICAgdmFyIGRhdGEgPSAkZWwuZGF0YSgpCgogICAgc3RhdGUgKz0gJ1RleHQnCgogICAgaWYgKGRhdGEucmVzZXRUZXh0ID09IG51bGwpICRlbC5kYXRhKCdyZXNldFRleHQnLCAkZWxbdmFsXSgpKQoKICAgIC8vIHB1c2ggdG8gZXZlbnQgbG9vcCB0byBhbGxvdyBmb3JtcyB0byBzdWJtaXQKICAgIHNldFRpbWVvdXQoJC5wcm94eShmdW5jdGlvbiAoKSB7CiAgICAgICRlbFt2YWxdKGRhdGFbc3RhdGVdID09IG51bGwgPyB0aGlzLm9wdGlvbnNbc3RhdGVdIDogZGF0YVtzdGF0ZV0pCgogICAgICBpZiAoc3RhdGUgPT0gJ2xvYWRpbmdUZXh0JykgewogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZQogICAgICAgICRlbC5hZGRDbGFzcyhkKS5hdHRyKGQsIGQpCiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0xvYWRpbmcpIHsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlCiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKGQpLnJlbW92ZUF0dHIoZCkKICAgICAgfQogICAgfSwgdGhpcyksIDApCiAgfQoKICBCdXR0b24ucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjaGFuZ2VkID0gdHJ1ZQogICAgdmFyICRwYXJlbnQgPSB0aGlzLiRlbGVtZW50LmNsb3Nlc3QoJ1tkYXRhLXRvZ2dsZT0iYnV0dG9ucyJdJykKCiAgICBpZiAoJHBhcmVudC5sZW5ndGgpIHsKICAgICAgdmFyICRpbnB1dCA9IHRoaXMuJGVsZW1lbnQuZmluZCgnaW5wdXQnKQogICAgICBpZiAoJGlucHV0LnByb3AoJ3R5cGUnKSA9PSAncmFkaW8nKSB7CiAgICAgICAgaWYgKCRpbnB1dC5wcm9wKCdjaGVja2VkJykpIGNoYW5nZWQgPSBmYWxzZQogICAgICAgICRwYXJlbnQuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKQogICAgICAgIHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpCiAgICAgIH0gZWxzZSBpZiAoJGlucHV0LnByb3AoJ3R5cGUnKSA9PSAnY2hlY2tib3gnKSB7CiAgICAgICAgaWYgKCgkaW5wdXQucHJvcCgnY2hlY2tlZCcpKSAhPT0gdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnYWN0aXZlJykpIGNoYW5nZWQgPSBmYWxzZQogICAgICAgIHRoaXMuJGVsZW1lbnQudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpCiAgICAgIH0KICAgICAgJGlucHV0LnByb3AoJ2NoZWNrZWQnLCB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdhY3RpdmUnKSkKICAgICAgaWYgKGNoYW5nZWQpICRpbnB1dC50cmlnZ2VyKCdjaGFuZ2UnKQogICAgfSBlbHNlIHsKICAgICAgdGhpcy4kZWxlbWVudC5hdHRyKCdhcmlhLXByZXNzZWQnLCAhdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnYWN0aXZlJykpCiAgICAgIHRoaXMuJGVsZW1lbnQudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpCiAgICB9CiAgfQoKCiAgLy8gQlVUVE9OIFBMVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHRoaXMgICA9ICQodGhpcykKICAgICAgdmFyIGRhdGEgICAgPSAkdGhpcy5kYXRhKCdicy5idXR0b24nKQogICAgICB2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uCgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLmJ1dHRvbicsIChkYXRhID0gbmV3IEJ1dHRvbih0aGlzLCBvcHRpb25zKSkpCgogICAgICBpZiAob3B0aW9uID09ICd0b2dnbGUnKSBkYXRhLnRvZ2dsZSgpCiAgICAgIGVsc2UgaWYgKG9wdGlvbikgZGF0YS5zZXRTdGF0ZShvcHRpb24pCiAgICB9KQogIH0KCiAgdmFyIG9sZCA9ICQuZm4uYnV0dG9uCgogICQuZm4uYnV0dG9uICAgICAgICAgICAgID0gUGx1Z2luCiAgJC5mbi5idXR0b24uQ29uc3RydWN0b3IgPSBCdXR0b24KCgogIC8vIEJVVFRPTiBOTyBDT05GTElDVAogIC8vID09PT09PT09PT09PT09PT09PQoKICAkLmZuLmJ1dHRvbi5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbi5idXR0b24gPSBvbGQKICAgIHJldHVybiB0aGlzCiAgfQoKCiAgLy8gQlVUVE9OIERBVEEtQVBJCiAgLy8gPT09PT09PT09PT09PT09CgogICQoZG9jdW1lbnQpCiAgICAub24oJ2NsaWNrLmJzLmJ1dHRvbi5kYXRhLWFwaScsICdbZGF0YS10b2dnbGVePSJidXR0b24iXScsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciAkYnRuID0gJChlLnRhcmdldCkKICAgICAgaWYgKCEkYnRuLmhhc0NsYXNzKCdidG4nKSkgJGJ0biA9ICRidG4uY2xvc2VzdCgnLmJ0bicpCiAgICAgIFBsdWdpbi5jYWxsKCRidG4sICd0b2dnbGUnKQogICAgICBpZiAoISgkKGUudGFyZ2V0KS5pcygnaW5wdXRbdHlwZT0icmFkaW8iXScpIHx8ICQoZS50YXJnZXQpLmlzKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdJykpKSBlLnByZXZlbnREZWZhdWx0KCkKICAgIH0pCiAgICAub24oJ2ZvY3VzLmJzLmJ1dHRvbi5kYXRhLWFwaSBibHVyLmJzLmJ1dHRvbi5kYXRhLWFwaScsICdbZGF0YS10b2dnbGVePSJidXR0b24iXScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICQoZS50YXJnZXQpLmNsb3Nlc3QoJy5idG4nKS50b2dnbGVDbGFzcygnZm9jdXMnLCAvXmZvY3VzKGluKT8kLy50ZXN0KGUudHlwZSkpCiAgICB9KQoKfShqUXVlcnkpOwoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIEJvb3RzdHJhcDogY2Fyb3VzZWwuanMgdjMuMy41CiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI2Nhcm91c2VsCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQgMjAxMS0yMDE1IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgoKK2Z1bmN0aW9uICgkKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBDQVJPVVNFTCBDTEFTUyBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PQoKICB2YXIgQ2Fyb3VzZWwgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykgewogICAgdGhpcy4kZWxlbWVudCAgICA9ICQoZWxlbWVudCkKICAgIHRoaXMuJGluZGljYXRvcnMgPSB0aGlzLiRlbGVtZW50LmZpbmQoJy5jYXJvdXNlbC1pbmRpY2F0b3JzJykKICAgIHRoaXMub3B0aW9ucyAgICAgPSBvcHRpb25zCiAgICB0aGlzLnBhdXNlZCAgICAgID0gbnVsbAogICAgdGhpcy5zbGlkaW5nICAgICA9IG51bGwKICAgIHRoaXMuaW50ZXJ2YWwgICAgPSBudWxsCiAgICB0aGlzLiRhY3RpdmUgICAgID0gbnVsbAogICAgdGhpcy4kaXRlbXMgICAgICA9IG51bGwKCiAgICB0aGlzLm9wdGlvbnMua2V5Ym9hcmQgJiYgdGhpcy4kZWxlbWVudC5vbigna2V5ZG93bi5icy5jYXJvdXNlbCcsICQucHJveHkodGhpcy5rZXlkb3duLCB0aGlzKSkKCiAgICB0aGlzLm9wdGlvbnMucGF1c2UgPT0gJ2hvdmVyJyAmJiAhKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgJiYgdGhpcy4kZWxlbWVudAogICAgICAub24oJ21vdXNlZW50ZXIuYnMuY2Fyb3VzZWwnLCAkLnByb3h5KHRoaXMucGF1c2UsIHRoaXMpKQogICAgICAub24oJ21vdXNlbGVhdmUuYnMuY2Fyb3VzZWwnLCAkLnByb3h5KHRoaXMuY3ljbGUsIHRoaXMpKQogIH0KCiAgQ2Fyb3VzZWwuVkVSU0lPTiAgPSAnMy4zLjUnCgogIENhcm91c2VsLlRSQU5TSVRJT05fRFVSQVRJT04gPSA2MDAKCiAgQ2Fyb3VzZWwuREVGQVVMVFMgPSB7CiAgICBpbnRlcnZhbDogNTAwMCwKICAgIHBhdXNlOiAnaG92ZXInLAogICAgd3JhcDogdHJ1ZSwKICAgIGtleWJvYXJkOiB0cnVlCiAgfQoKICBDYXJvdXNlbC5wcm90b3R5cGUua2V5ZG93biA9IGZ1bmN0aW9uIChlKSB7CiAgICBpZiAoL2lucHV0fHRleHRhcmVhL2kudGVzdChlLnRhcmdldC50YWdOYW1lKSkgcmV0dXJuCiAgICBzd2l0Y2ggKGUud2hpY2gpIHsKICAgICAgY2FzZSAzNzogdGhpcy5wcmV2KCk7IGJyZWFrCiAgICAgIGNhc2UgMzk6IHRoaXMubmV4dCgpOyBicmVhawogICAgICBkZWZhdWx0OiByZXR1cm4KICAgIH0KCiAgICBlLnByZXZlbnREZWZhdWx0KCkKICB9CgogIENhcm91c2VsLnByb3RvdHlwZS5jeWNsZSA9IGZ1bmN0aW9uIChlKSB7CiAgICBlIHx8ICh0aGlzLnBhdXNlZCA9IGZhbHNlKQoKICAgIHRoaXMuaW50ZXJ2YWwgJiYgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKQoKICAgIHRoaXMub3B0aW9ucy5pbnRlcnZhbAogICAgICAmJiAhdGhpcy5wYXVzZWQKICAgICAgJiYgKHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgkLnByb3h5KHRoaXMubmV4dCwgdGhpcyksIHRoaXMub3B0aW9ucy5pbnRlcnZhbCkpCgogICAgcmV0dXJuIHRoaXMKICB9CgogIENhcm91c2VsLnByb3RvdHlwZS5nZXRJdGVtSW5kZXggPSBmdW5jdGlvbiAoaXRlbSkgewogICAgdGhpcy4kaXRlbXMgPSBpdGVtLnBhcmVudCgpLmNoaWxkcmVuKCcuaXRlbScpCiAgICByZXR1cm4gdGhpcy4kaXRlbXMuaW5kZXgoaXRlbSB8fCB0aGlzLiRhY3RpdmUpCiAgfQoKICBDYXJvdXNlbC5wcm90b3R5cGUuZ2V0SXRlbUZvckRpcmVjdGlvbiA9IGZ1bmN0aW9uIChkaXJlY3Rpb24sIGFjdGl2ZSkgewogICAgdmFyIGFjdGl2ZUluZGV4ID0gdGhpcy5nZXRJdGVtSW5kZXgoYWN0aXZlKQogICAgdmFyIHdpbGxXcmFwID0gKGRpcmVjdGlvbiA9PSAncHJldicgJiYgYWN0aXZlSW5kZXggPT09IDApCiAgICAgICAgICAgICAgICB8fCAoZGlyZWN0aW9uID09ICduZXh0JyAmJiBhY3RpdmVJbmRleCA9PSAodGhpcy4kaXRlbXMubGVuZ3RoIC0gMSkpCiAgICBpZiAod2lsbFdyYXAgJiYgIXRoaXMub3B0aW9ucy53cmFwKSByZXR1cm4gYWN0aXZlCiAgICB2YXIgZGVsdGEgPSBkaXJlY3Rpb24gPT0gJ3ByZXYnID8gLTEgOiAxCiAgICB2YXIgaXRlbUluZGV4ID0gKGFjdGl2ZUluZGV4ICsgZGVsdGEpICUgdGhpcy4kaXRlbXMubGVuZ3RoCiAgICByZXR1cm4gdGhpcy4kaXRlbXMuZXEoaXRlbUluZGV4KQogIH0KCiAgQ2Fyb3VzZWwucHJvdG90eXBlLnRvID0gZnVuY3Rpb24gKHBvcykgewogICAgdmFyIHRoYXQgICAgICAgID0gdGhpcwogICAgdmFyIGFjdGl2ZUluZGV4ID0gdGhpcy5nZXRJdGVtSW5kZXgodGhpcy4kYWN0aXZlID0gdGhpcy4kZWxlbWVudC5maW5kKCcuaXRlbS5hY3RpdmUnKSkKCiAgICBpZiAocG9zID4gKHRoaXMuJGl0ZW1zLmxlbmd0aCAtIDEpIHx8IHBvcyA8IDApIHJldHVybgoKICAgIGlmICh0aGlzLnNsaWRpbmcpICAgICAgIHJldHVybiB0aGlzLiRlbGVtZW50Lm9uZSgnc2xpZC5icy5jYXJvdXNlbCcsIGZ1bmN0aW9uICgpIHsgdGhhdC50byhwb3MpIH0pIC8vIHllcywgInNsaWQiCiAgICBpZiAoYWN0aXZlSW5kZXggPT0gcG9zKSByZXR1cm4gdGhpcy5wYXVzZSgpLmN5Y2xlKCkKCiAgICByZXR1cm4gdGhpcy5zbGlkZShwb3MgPiBhY3RpdmVJbmRleCA/ICduZXh0JyA6ICdwcmV2JywgdGhpcy4kaXRlbXMuZXEocG9zKSkKICB9CgogIENhcm91c2VsLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uIChlKSB7CiAgICBlIHx8ICh0aGlzLnBhdXNlZCA9IHRydWUpCgogICAgaWYgKHRoaXMuJGVsZW1lbnQuZmluZCgnLm5leHQsIC5wcmV2JykubGVuZ3RoICYmICQuc3VwcG9ydC50cmFuc2l0aW9uKSB7CiAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcigkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQpCiAgICAgIHRoaXMuY3ljbGUodHJ1ZSkKICAgIH0KCiAgICB0aGlzLmludGVydmFsID0gY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKQoKICAgIHJldHVybiB0aGlzCiAgfQoKICBDYXJvdXNlbC5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLnNsaWRpbmcpIHJldHVybgogICAgcmV0dXJuIHRoaXMuc2xpZGUoJ25leHQnKQogIH0KCiAgQ2Fyb3VzZWwucHJvdG90eXBlLnByZXYgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5zbGlkaW5nKSByZXR1cm4KICAgIHJldHVybiB0aGlzLnNsaWRlKCdwcmV2JykKICB9CgogIENhcm91c2VsLnByb3RvdHlwZS5zbGlkZSA9IGZ1bmN0aW9uICh0eXBlLCBuZXh0KSB7CiAgICB2YXIgJGFjdGl2ZSAgID0gdGhpcy4kZWxlbWVudC5maW5kKCcuaXRlbS5hY3RpdmUnKQogICAgdmFyICRuZXh0ICAgICA9IG5leHQgfHwgdGhpcy5nZXRJdGVtRm9yRGlyZWN0aW9uKHR5cGUsICRhY3RpdmUpCiAgICB2YXIgaXNDeWNsaW5nID0gdGhpcy5pbnRlcnZhbAogICAgdmFyIGRpcmVjdGlvbiA9IHR5cGUgPT0gJ25leHQnID8gJ2xlZnQnIDogJ3JpZ2h0JwogICAgdmFyIHRoYXQgICAgICA9IHRoaXMKCiAgICBpZiAoJG5leHQuaGFzQ2xhc3MoJ2FjdGl2ZScpKSByZXR1cm4gKHRoaXMuc2xpZGluZyA9IGZhbHNlKQoKICAgIHZhciByZWxhdGVkVGFyZ2V0ID0gJG5leHRbMF0KICAgIHZhciBzbGlkZUV2ZW50ID0gJC5FdmVudCgnc2xpZGUuYnMuY2Fyb3VzZWwnLCB7CiAgICAgIHJlbGF0ZWRUYXJnZXQ6IHJlbGF0ZWRUYXJnZXQsCiAgICAgIGRpcmVjdGlvbjogZGlyZWN0aW9uCiAgICB9KQogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKHNsaWRlRXZlbnQpCiAgICBpZiAoc2xpZGVFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgdGhpcy5zbGlkaW5nID0gdHJ1ZQoKICAgIGlzQ3ljbGluZyAmJiB0aGlzLnBhdXNlKCkKCiAgICBpZiAodGhpcy4kaW5kaWNhdG9ycy5sZW5ndGgpIHsKICAgICAgdGhpcy4kaW5kaWNhdG9ycy5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpCiAgICAgIHZhciAkbmV4dEluZGljYXRvciA9ICQodGhpcy4kaW5kaWNhdG9ycy5jaGlsZHJlbigpW3RoaXMuZ2V0SXRlbUluZGV4KCRuZXh0KV0pCiAgICAgICRuZXh0SW5kaWNhdG9yICYmICRuZXh0SW5kaWNhdG9yLmFkZENsYXNzKCdhY3RpdmUnKQogICAgfQoKICAgIHZhciBzbGlkRXZlbnQgPSAkLkV2ZW50KCdzbGlkLmJzLmNhcm91c2VsJywgeyByZWxhdGVkVGFyZ2V0OiByZWxhdGVkVGFyZ2V0LCBkaXJlY3Rpb246IGRpcmVjdGlvbiB9KSAvLyB5ZXMsICJzbGlkIgogICAgaWYgKCQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ3NsaWRlJykpIHsKICAgICAgJG5leHQuYWRkQ2xhc3ModHlwZSkKICAgICAgJG5leHRbMF0ub2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93CiAgICAgICRhY3RpdmUuYWRkQ2xhc3MoZGlyZWN0aW9uKQogICAgICAkbmV4dC5hZGRDbGFzcyhkaXJlY3Rpb24pCiAgICAgICRhY3RpdmUKICAgICAgICAub25lKCdic1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkbmV4dC5yZW1vdmVDbGFzcyhbdHlwZSwgZGlyZWN0aW9uXS5qb2luKCcgJykpLmFkZENsYXNzKCdhY3RpdmUnKQogICAgICAgICAgJGFjdGl2ZS5yZW1vdmVDbGFzcyhbJ2FjdGl2ZScsIGRpcmVjdGlvbl0uam9pbignICcpKQogICAgICAgICAgdGhhdC5zbGlkaW5nID0gZmFsc2UKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoc2xpZEV2ZW50KQogICAgICAgICAgfSwgMCkKICAgICAgICB9KQogICAgICAgIC5lbXVsYXRlVHJhbnNpdGlvbkVuZChDYXJvdXNlbC5UUkFOU0lUSU9OX0RVUkFUSU9OKQogICAgfSBlbHNlIHsKICAgICAgJGFjdGl2ZS5yZW1vdmVDbGFzcygnYWN0aXZlJykKICAgICAgJG5leHQuYWRkQ2xhc3MoJ2FjdGl2ZScpCiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlCiAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihzbGlkRXZlbnQpCiAgICB9CgogICAgaXNDeWNsaW5nICYmIHRoaXMuY3ljbGUoKQoKICAgIHJldHVybiB0aGlzCiAgfQoKCiAgLy8gQ0FST1VTRUwgUExVR0lOIERFRklOSVRJT04KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PQoKICBmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICR0aGlzICAgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhICAgID0gJHRoaXMuZGF0YSgnYnMuY2Fyb3VzZWwnKQogICAgICB2YXIgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBDYXJvdXNlbC5ERUZBVUxUUywgJHRoaXMuZGF0YSgpLCB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbikKICAgICAgdmFyIGFjdGlvbiAgPSB0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnID8gb3B0aW9uIDogb3B0aW9ucy5zbGlkZQoKICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5jYXJvdXNlbCcsIChkYXRhID0gbmV3IENhcm91c2VsKHRoaXMsIG9wdGlvbnMpKSkKICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ251bWJlcicpIGRhdGEudG8ob3B0aW9uKQogICAgICBlbHNlIGlmIChhY3Rpb24pIGRhdGFbYWN0aW9uXSgpCiAgICAgIGVsc2UgaWYgKG9wdGlvbnMuaW50ZXJ2YWwpIGRhdGEucGF1c2UoKS5jeWNsZSgpCiAgICB9KQogIH0KCiAgdmFyIG9sZCA9ICQuZm4uY2Fyb3VzZWwKCiAgJC5mbi5jYXJvdXNlbCAgICAgICAgICAgICA9IFBsdWdpbgogICQuZm4uY2Fyb3VzZWwuQ29uc3RydWN0b3IgPSBDYXJvdXNlbAoKCiAgLy8gQ0FST1VTRUwgTk8gQ09ORkxJQ1QKICAvLyA9PT09PT09PT09PT09PT09PT09PQoKICAkLmZuLmNhcm91c2VsLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmZuLmNhcm91c2VsID0gb2xkCiAgICByZXR1cm4gdGhpcwogIH0KCgogIC8vIENBUk9VU0VMIERBVEEtQVBJCiAgLy8gPT09PT09PT09PT09PT09PT0KCiAgdmFyIGNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7CiAgICB2YXIgaHJlZgogICAgdmFyICR0aGlzICAgPSAkKHRoaXMpCiAgICB2YXIgJHRhcmdldCA9ICQoJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKSB8fCAoaHJlZiA9ICR0aGlzLmF0dHIoJ2hyZWYnKSkgJiYgaHJlZi5yZXBsYWNlKC8uKig/PSNbXlxzXSskKS8sICcnKSkgLy8gc3RyaXAgZm9yIGllNwogICAgaWYgKCEkdGFyZ2V0Lmhhc0NsYXNzKCdjYXJvdXNlbCcpKSByZXR1cm4KICAgIHZhciBvcHRpb25zID0gJC5leHRlbmQoe30sICR0YXJnZXQuZGF0YSgpLCAkdGhpcy5kYXRhKCkpCiAgICB2YXIgc2xpZGVJbmRleCA9ICR0aGlzLmF0dHIoJ2RhdGEtc2xpZGUtdG8nKQogICAgaWYgKHNsaWRlSW5kZXgpIG9wdGlvbnMuaW50ZXJ2YWwgPSBmYWxzZQoKICAgIFBsdWdpbi5jYWxsKCR0YXJnZXQsIG9wdGlvbnMpCgogICAgaWYgKHNsaWRlSW5kZXgpIHsKICAgICAgJHRhcmdldC5kYXRhKCdicy5jYXJvdXNlbCcpLnRvKHNsaWRlSW5kZXgpCiAgICB9CgogICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgfQoKICAkKGRvY3VtZW50KQogICAgLm9uKCdjbGljay5icy5jYXJvdXNlbC5kYXRhLWFwaScsICdbZGF0YS1zbGlkZV0nLCBjbGlja0hhbmRsZXIpCiAgICAub24oJ2NsaWNrLmJzLmNhcm91c2VsLmRhdGEtYXBpJywgJ1tkYXRhLXNsaWRlLXRvXScsIGNsaWNrSGFuZGxlcikKCiAgJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkgewogICAgJCgnW2RhdGEtcmlkZT0iY2Fyb3VzZWwiXScpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJGNhcm91c2VsID0gJCh0aGlzKQogICAgICBQbHVnaW4uY2FsbCgkY2Fyb3VzZWwsICRjYXJvdXNlbC5kYXRhKCkpCiAgICB9KQogIH0pCgp9KGpRdWVyeSk7CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQm9vdHN0cmFwOiBjb2xsYXBzZS5qcyB2My4zLjUKICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jY29sbGFwc2UKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvcHlyaWdodCAyMDExLTIwMTUgVHdpdHRlciwgSW5jLgogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIENPTExBUFNFIFBVQkxJQyBDTEFTUyBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgdmFyIENvbGxhcHNlID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMuJGVsZW1lbnQgICAgICA9ICQoZWxlbWVudCkKICAgIHRoaXMub3B0aW9ucyAgICAgICA9ICQuZXh0ZW5kKHt9LCBDb2xsYXBzZS5ERUZBVUxUUywgb3B0aW9ucykKICAgIHRoaXMuJHRyaWdnZXIgICAgICA9ICQoJ1tkYXRhLXRvZ2dsZT0iY29sbGFwc2UiXVtocmVmPSIjJyArIGVsZW1lbnQuaWQgKyAnIl0sJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl1bZGF0YS10YXJnZXQ9IiMnICsgZWxlbWVudC5pZCArICciXScpCiAgICB0aGlzLnRyYW5zaXRpb25pbmcgPSBudWxsCgogICAgaWYgKHRoaXMub3B0aW9ucy5wYXJlbnQpIHsKICAgICAgdGhpcy4kcGFyZW50ID0gdGhpcy5nZXRQYXJlbnQoKQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5hZGRBcmlhQW5kQ29sbGFwc2VkQ2xhc3ModGhpcy4kZWxlbWVudCwgdGhpcy4kdHJpZ2dlcikKICAgIH0KCiAgICBpZiAodGhpcy5vcHRpb25zLnRvZ2dsZSkgdGhpcy50b2dnbGUoKQogIH0KCiAgQ29sbGFwc2UuVkVSU0lPTiAgPSAnMy4zLjUnCgogIENvbGxhcHNlLlRSQU5TSVRJT05fRFVSQVRJT04gPSAzNTAKCiAgQ29sbGFwc2UuREVGQVVMVFMgPSB7CiAgICB0b2dnbGU6IHRydWUKICB9CgogIENvbGxhcHNlLnByb3RvdHlwZS5kaW1lbnNpb24gPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaGFzV2lkdGggPSB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCd3aWR0aCcpCiAgICByZXR1cm4gaGFzV2lkdGggPyAnd2lkdGgnIDogJ2hlaWdodCcKICB9CgogIENvbGxhcHNlLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMudHJhbnNpdGlvbmluZyB8fCB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdpbicpKSByZXR1cm4KCiAgICB2YXIgYWN0aXZlc0RhdGEKICAgIHZhciBhY3RpdmVzID0gdGhpcy4kcGFyZW50ICYmIHRoaXMuJHBhcmVudC5jaGlsZHJlbignLnBhbmVsJykuY2hpbGRyZW4oJy5pbiwgLmNvbGxhcHNpbmcnKQoKICAgIGlmIChhY3RpdmVzICYmIGFjdGl2ZXMubGVuZ3RoKSB7CiAgICAgIGFjdGl2ZXNEYXRhID0gYWN0aXZlcy5kYXRhKCdicy5jb2xsYXBzZScpCiAgICAgIGlmIChhY3RpdmVzRGF0YSAmJiBhY3RpdmVzRGF0YS50cmFuc2l0aW9uaW5nKSByZXR1cm4KICAgIH0KCiAgICB2YXIgc3RhcnRFdmVudCA9ICQuRXZlbnQoJ3Nob3cuYnMuY29sbGFwc2UnKQogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKHN0YXJ0RXZlbnQpCiAgICBpZiAoc3RhcnRFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgaWYgKGFjdGl2ZXMgJiYgYWN0aXZlcy5sZW5ndGgpIHsKICAgICAgUGx1Z2luLmNhbGwoYWN0aXZlcywgJ2hpZGUnKQogICAgICBhY3RpdmVzRGF0YSB8fCBhY3RpdmVzLmRhdGEoJ2JzLmNvbGxhcHNlJywgbnVsbCkKICAgIH0KCiAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5kaW1lbnNpb24oKQoKICAgIHRoaXMuJGVsZW1lbnQKICAgICAgLnJlbW92ZUNsYXNzKCdjb2xsYXBzZScpCiAgICAgIC5hZGRDbGFzcygnY29sbGFwc2luZycpW2RpbWVuc2lvbl0oMCkKICAgICAgLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKQoKICAgIHRoaXMuJHRyaWdnZXIKICAgICAgLnJlbW92ZUNsYXNzKCdjb2xsYXBzZWQnKQogICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsIHRydWUpCgogICAgdGhpcy50cmFuc2l0aW9uaW5nID0gMQoKICAgIHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy4kZWxlbWVudAogICAgICAgIC5yZW1vdmVDbGFzcygnY29sbGFwc2luZycpCiAgICAgICAgLmFkZENsYXNzKCdjb2xsYXBzZSBpbicpW2RpbWVuc2lvbl0oJycpCiAgICAgIHRoaXMudHJhbnNpdGlvbmluZyA9IDAKICAgICAgdGhpcy4kZWxlbWVudAogICAgICAgIC50cmlnZ2VyKCdzaG93bi5icy5jb2xsYXBzZScpCiAgICB9CgogICAgaWYgKCEkLnN1cHBvcnQudHJhbnNpdGlvbikgcmV0dXJuIGNvbXBsZXRlLmNhbGwodGhpcykKCiAgICB2YXIgc2Nyb2xsU2l6ZSA9ICQuY2FtZWxDYXNlKFsnc2Nyb2xsJywgZGltZW5zaW9uXS5qb2luKCctJykpCgogICAgdGhpcy4kZWxlbWVudAogICAgICAub25lKCdic1RyYW5zaXRpb25FbmQnLCAkLnByb3h5KGNvbXBsZXRlLCB0aGlzKSkKICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKENvbGxhcHNlLlRSQU5TSVRJT05fRFVSQVRJT04pW2RpbWVuc2lvbl0odGhpcy4kZWxlbWVudFswXVtzY3JvbGxTaXplXSkKICB9CgogIENvbGxhcHNlLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMudHJhbnNpdGlvbmluZyB8fCAhdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnaW4nKSkgcmV0dXJuCgogICAgdmFyIHN0YXJ0RXZlbnQgPSAkLkV2ZW50KCdoaWRlLmJzLmNvbGxhcHNlJykKICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihzdGFydEV2ZW50KQogICAgaWYgKHN0YXJ0RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybgoKICAgIHZhciBkaW1lbnNpb24gPSB0aGlzLmRpbWVuc2lvbigpCgogICAgdGhpcy4kZWxlbWVudFtkaW1lbnNpb25dKHRoaXMuJGVsZW1lbnRbZGltZW5zaW9uXSgpKVswXS5vZmZzZXRIZWlnaHQKCiAgICB0aGlzLiRlbGVtZW50CiAgICAgIC5hZGRDbGFzcygnY29sbGFwc2luZycpCiAgICAgIC5yZW1vdmVDbGFzcygnY29sbGFwc2UgaW4nKQogICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsIGZhbHNlKQoKICAgIHRoaXMuJHRyaWdnZXIKICAgICAgLmFkZENsYXNzKCdjb2xsYXBzZWQnKQogICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsIGZhbHNlKQoKICAgIHRoaXMudHJhbnNpdGlvbmluZyA9IDEKCiAgICB2YXIgY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMudHJhbnNpdGlvbmluZyA9IDAKICAgICAgdGhpcy4kZWxlbWVudAogICAgICAgIC5yZW1vdmVDbGFzcygnY29sbGFwc2luZycpCiAgICAgICAgLmFkZENsYXNzKCdjb2xsYXBzZScpCiAgICAgICAgLnRyaWdnZXIoJ2hpZGRlbi5icy5jb2xsYXBzZScpCiAgICB9CgogICAgaWYgKCEkLnN1cHBvcnQudHJhbnNpdGlvbikgcmV0dXJuIGNvbXBsZXRlLmNhbGwodGhpcykKCiAgICB0aGlzLiRlbGVtZW50CiAgICAgIFtkaW1lbnNpb25dKDApCiAgICAgIC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsICQucHJveHkoY29tcGxldGUsIHRoaXMpKQogICAgICAuZW11bGF0ZVRyYW5zaXRpb25FbmQoQ29sbGFwc2UuVFJBTlNJVElPTl9EVVJBVElPTikKICB9CgogIENvbGxhcHNlLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzW3RoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2luJykgPyAnaGlkZScgOiAnc2hvdyddKCkKICB9CgogIENvbGxhcHNlLnByb3RvdHlwZS5nZXRQYXJlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gJCh0aGlzLm9wdGlvbnMucGFyZW50KQogICAgICAuZmluZCgnW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdW2RhdGEtcGFyZW50PSInICsgdGhpcy5vcHRpb25zLnBhcmVudCArICciXScpCiAgICAgIC5lYWNoKCQucHJveHkoZnVuY3Rpb24gKGksIGVsZW1lbnQpIHsKICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKGVsZW1lbnQpCiAgICAgICAgdGhpcy5hZGRBcmlhQW5kQ29sbGFwc2VkQ2xhc3MoZ2V0VGFyZ2V0RnJvbVRyaWdnZXIoJGVsZW1lbnQpLCAkZWxlbWVudCkKICAgICAgfSwgdGhpcykpCiAgICAgIC5lbmQoKQogIH0KCiAgQ29sbGFwc2UucHJvdG90eXBlLmFkZEFyaWFBbmRDb2xsYXBzZWRDbGFzcyA9IGZ1bmN0aW9uICgkZWxlbWVudCwgJHRyaWdnZXIpIHsKICAgIHZhciBpc09wZW4gPSAkZWxlbWVudC5oYXNDbGFzcygnaW4nKQoKICAgICRlbGVtZW50LmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCBpc09wZW4pCiAgICAkdHJpZ2dlcgogICAgICAudG9nZ2xlQ2xhc3MoJ2NvbGxhcHNlZCcsICFpc09wZW4pCiAgICAgIC5hdHRyKCdhcmlhLWV4cGFuZGVkJywgaXNPcGVuKQogIH0KCiAgZnVuY3Rpb24gZ2V0VGFyZ2V0RnJvbVRyaWdnZXIoJHRyaWdnZXIpIHsKICAgIHZhciBocmVmCiAgICB2YXIgdGFyZ2V0ID0gJHRyaWdnZXIuYXR0cignZGF0YS10YXJnZXQnKQogICAgICB8fCAoaHJlZiA9ICR0cmlnZ2VyLmF0dHIoJ2hyZWYnKSkgJiYgaHJlZi5yZXBsYWNlKC8uKig/PSNbXlxzXSskKS8sICcnKSAvLyBzdHJpcCBmb3IgaWU3CgogICAgcmV0dXJuICQodGFyZ2V0KQogIH0KCgogIC8vIENPTExBUFNFIFBMVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikgewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKQogICAgICB2YXIgZGF0YSAgICA9ICR0aGlzLmRhdGEoJ2JzLmNvbGxhcHNlJykKICAgICAgdmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQ29sbGFwc2UuREVGQVVMVFMsICR0aGlzLmRhdGEoKSwgdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24pCgogICAgICBpZiAoIWRhdGEgJiYgb3B0aW9ucy50b2dnbGUgJiYgL3Nob3d8aGlkZS8udGVzdChvcHRpb24pKSBvcHRpb25zLnRvZ2dsZSA9IGZhbHNlCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuY29sbGFwc2UnLCAoZGF0YSA9IG5ldyBDb2xsYXBzZSh0aGlzLCBvcHRpb25zKSkpCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKQogICAgfSkKICB9CgogIHZhciBvbGQgPSAkLmZuLmNvbGxhcHNlCgogICQuZm4uY29sbGFwc2UgICAgICAgICAgICAgPSBQbHVnaW4KICAkLmZuLmNvbGxhcHNlLkNvbnN0cnVjdG9yID0gQ29sbGFwc2UKCgogIC8vIENPTExBUFNFIE5PIENPTkZMSUNUCiAgLy8gPT09PT09PT09PT09PT09PT09PT0KCiAgJC5mbi5jb2xsYXBzZS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbi5jb2xsYXBzZSA9IG9sZAogICAgcmV0dXJuIHRoaXMKICB9CgoKICAvLyBDT0xMQVBTRSBEQVRBLUFQSQogIC8vID09PT09PT09PT09PT09PT09CgogICQoZG9jdW1lbnQpLm9uKCdjbGljay5icy5jb2xsYXBzZS5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl0nLCBmdW5jdGlvbiAoZSkgewogICAgdmFyICR0aGlzICAgPSAkKHRoaXMpCgogICAgaWYgKCEkdGhpcy5hdHRyKCdkYXRhLXRhcmdldCcpKSBlLnByZXZlbnREZWZhdWx0KCkKCiAgICB2YXIgJHRhcmdldCA9IGdldFRhcmdldEZyb21UcmlnZ2VyKCR0aGlzKQogICAgdmFyIGRhdGEgICAgPSAkdGFyZ2V0LmRhdGEoJ2JzLmNvbGxhcHNlJykKICAgIHZhciBvcHRpb24gID0gZGF0YSA/ICd0b2dnbGUnIDogJHRoaXMuZGF0YSgpCgogICAgUGx1Z2luLmNhbGwoJHRhcmdldCwgb3B0aW9uKQogIH0pCgp9KGpRdWVyeSk7CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQm9vdHN0cmFwOiBkcm9wZG93bi5qcyB2My4zLjUKICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jZHJvcGRvd25zCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQgMjAxMS0yMDE1IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgoKK2Z1bmN0aW9uICgkKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBEUk9QRE9XTiBDTEFTUyBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PQoKICB2YXIgYmFja2Ryb3AgPSAnLmRyb3Bkb3duLWJhY2tkcm9wJwogIHZhciB0b2dnbGUgICA9ICdbZGF0YS10b2dnbGU9ImRyb3Bkb3duIl0nCiAgdmFyIERyb3Bkb3duID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICQoZWxlbWVudCkub24oJ2NsaWNrLmJzLmRyb3Bkb3duJywgdGhpcy50b2dnbGUpCiAgfQoKICBEcm9wZG93bi5WRVJTSU9OID0gJzMuMy41JwoKICBmdW5jdGlvbiBnZXRQYXJlbnQoJHRoaXMpIHsKICAgIHZhciBzZWxlY3RvciA9ICR0aGlzLmF0dHIoJ2RhdGEtdGFyZ2V0JykKCiAgICBpZiAoIXNlbGVjdG9yKSB7CiAgICAgIHNlbGVjdG9yID0gJHRoaXMuYXR0cignaHJlZicpCiAgICAgIHNlbGVjdG9yID0gc2VsZWN0b3IgJiYgLyNbQS1aYS16XS8udGVzdChzZWxlY3RvcikgJiYgc2VsZWN0b3IucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCAnJykgLy8gc3RyaXAgZm9yIGllNwogICAgfQoKICAgIHZhciAkcGFyZW50ID0gc2VsZWN0b3IgJiYgJChzZWxlY3RvcikKCiAgICByZXR1cm4gJHBhcmVudCAmJiAkcGFyZW50Lmxlbmd0aCA/ICRwYXJlbnQgOiAkdGhpcy5wYXJlbnQoKQogIH0KCiAgZnVuY3Rpb24gY2xlYXJNZW51cyhlKSB7CiAgICBpZiAoZSAmJiBlLndoaWNoID09PSAzKSByZXR1cm4KICAgICQoYmFja2Ryb3ApLnJlbW92ZSgpCiAgICAkKHRvZ2dsZSkuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkdGhpcyAgICAgICAgID0gJCh0aGlzKQogICAgICB2YXIgJHBhcmVudCAgICAgICA9IGdldFBhcmVudCgkdGhpcykKICAgICAgdmFyIHJlbGF0ZWRUYXJnZXQgPSB7IHJlbGF0ZWRUYXJnZXQ6IHRoaXMgfQoKICAgICAgaWYgKCEkcGFyZW50Lmhhc0NsYXNzKCdvcGVuJykpIHJldHVybgoKICAgICAgaWYgKGUgJiYgZS50eXBlID09ICdjbGljaycgJiYgL2lucHV0fHRleHRhcmVhL2kudGVzdChlLnRhcmdldC50YWdOYW1lKSAmJiAkLmNvbnRhaW5zKCRwYXJlbnRbMF0sIGUudGFyZ2V0KSkgcmV0dXJuCgogICAgICAkcGFyZW50LnRyaWdnZXIoZSA9ICQuRXZlbnQoJ2hpZGUuYnMuZHJvcGRvd24nLCByZWxhdGVkVGFyZ2V0KSkKCiAgICAgIGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm4KCiAgICAgICR0aGlzLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKQogICAgICAkcGFyZW50LnJlbW92ZUNsYXNzKCdvcGVuJykudHJpZ2dlcignaGlkZGVuLmJzLmRyb3Bkb3duJywgcmVsYXRlZFRhcmdldCkKICAgIH0pCiAgfQoKICBEcm9wZG93bi5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24gKGUpIHsKICAgIHZhciAkdGhpcyA9ICQodGhpcykKCiAgICBpZiAoJHRoaXMuaXMoJy5kaXNhYmxlZCwgOmRpc2FibGVkJykpIHJldHVybgoKICAgIHZhciAkcGFyZW50ICA9IGdldFBhcmVudCgkdGhpcykKICAgIHZhciBpc0FjdGl2ZSA9ICRwYXJlbnQuaGFzQ2xhc3MoJ29wZW4nKQoKICAgIGNsZWFyTWVudXMoKQoKICAgIGlmICghaXNBY3RpdmUpIHsKICAgICAgaWYgKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiAhJHBhcmVudC5jbG9zZXN0KCcubmF2YmFyLW5hdicpLmxlbmd0aCkgewogICAgICAgIC8vIGlmIG1vYmlsZSB3ZSB1c2UgYSBiYWNrZHJvcCBiZWNhdXNlIGNsaWNrIGV2ZW50cyBkb24ndCBkZWxlZ2F0ZQogICAgICAgICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpCiAgICAgICAgICAuYWRkQ2xhc3MoJ2Ryb3Bkb3duLWJhY2tkcm9wJykKICAgICAgICAgIC5pbnNlcnRBZnRlcigkKHRoaXMpKQogICAgICAgICAgLm9uKCdjbGljaycsIGNsZWFyTWVudXMpCiAgICAgIH0KCiAgICAgIHZhciByZWxhdGVkVGFyZ2V0ID0geyByZWxhdGVkVGFyZ2V0OiB0aGlzIH0KICAgICAgJHBhcmVudC50cmlnZ2VyKGUgPSAkLkV2ZW50KCdzaG93LmJzLmRyb3Bkb3duJywgcmVsYXRlZFRhcmdldCkpCgogICAgICBpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgICAkdGhpcwogICAgICAgIC50cmlnZ2VyKCdmb2N1cycpCiAgICAgICAgLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpCgogICAgICAkcGFyZW50CiAgICAgICAgLnRvZ2dsZUNsYXNzKCdvcGVuJykKICAgICAgICAudHJpZ2dlcignc2hvd24uYnMuZHJvcGRvd24nLCByZWxhdGVkVGFyZ2V0KQogICAgfQoKICAgIHJldHVybiBmYWxzZQogIH0KCiAgRHJvcGRvd24ucHJvdG90eXBlLmtleWRvd24gPSBmdW5jdGlvbiAoZSkgewogICAgaWYgKCEvKDM4fDQwfDI3fDMyKS8udGVzdChlLndoaWNoKSB8fCAvaW5wdXR8dGV4dGFyZWEvaS50ZXN0KGUudGFyZ2V0LnRhZ05hbWUpKSByZXR1cm4KCiAgICB2YXIgJHRoaXMgPSAkKHRoaXMpCgogICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICBlLnN0b3BQcm9wYWdhdGlvbigpCgogICAgaWYgKCR0aGlzLmlzKCcuZGlzYWJsZWQsIDpkaXNhYmxlZCcpKSByZXR1cm4KCiAgICB2YXIgJHBhcmVudCAgPSBnZXRQYXJlbnQoJHRoaXMpCiAgICB2YXIgaXNBY3RpdmUgPSAkcGFyZW50Lmhhc0NsYXNzKCdvcGVuJykKCiAgICBpZiAoIWlzQWN0aXZlICYmIGUud2hpY2ggIT0gMjcgfHwgaXNBY3RpdmUgJiYgZS53aGljaCA9PSAyNykgewogICAgICBpZiAoZS53aGljaCA9PSAyNykgJHBhcmVudC5maW5kKHRvZ2dsZSkudHJpZ2dlcignZm9jdXMnKQogICAgICByZXR1cm4gJHRoaXMudHJpZ2dlcignY2xpY2snKQogICAgfQoKICAgIHZhciBkZXNjID0gJyBsaTpub3QoLmRpc2FibGVkKTp2aXNpYmxlIGEnCiAgICB2YXIgJGl0ZW1zID0gJHBhcmVudC5maW5kKCcuZHJvcGRvd24tbWVudScgKyBkZXNjKQoKICAgIGlmICghJGl0ZW1zLmxlbmd0aCkgcmV0dXJuCgogICAgdmFyIGluZGV4ID0gJGl0ZW1zLmluZGV4KGUudGFyZ2V0KQoKICAgIGlmIChlLndoaWNoID09IDM4ICYmIGluZGV4ID4gMCkgICAgICAgICAgICAgICAgIGluZGV4LS0gICAgICAgICAvLyB1cAogICAgaWYgKGUud2hpY2ggPT0gNDAgJiYgaW5kZXggPCAkaXRlbXMubGVuZ3RoIC0gMSkgaW5kZXgrKyAgICAgICAgIC8vIGRvd24KICAgIGlmICghfmluZGV4KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4ID0gMAoKICAgICRpdGVtcy5lcShpbmRleCkudHJpZ2dlcignZm9jdXMnKQogIH0KCgogIC8vIERST1BET1dOIFBMVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikgewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkdGhpcyA9ICQodGhpcykKICAgICAgdmFyIGRhdGEgID0gJHRoaXMuZGF0YSgnYnMuZHJvcGRvd24nKQoKICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5kcm9wZG93bicsIChkYXRhID0gbmV3IERyb3Bkb3duKHRoaXMpKSkKICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXS5jYWxsKCR0aGlzKQogICAgfSkKICB9CgogIHZhciBvbGQgPSAkLmZuLmRyb3Bkb3duCgogICQuZm4uZHJvcGRvd24gICAgICAgICAgICAgPSBQbHVnaW4KICAkLmZuLmRyb3Bkb3duLkNvbnN0cnVjdG9yID0gRHJvcGRvd24KCgogIC8vIERST1BET1dOIE5PIENPTkZMSUNUCiAgLy8gPT09PT09PT09PT09PT09PT09PT0KCiAgJC5mbi5kcm9wZG93bi5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbi5kcm9wZG93biA9IG9sZAogICAgcmV0dXJuIHRoaXMKICB9CgoKICAvLyBBUFBMWSBUTyBTVEFOREFSRCBEUk9QRE9XTiBFTEVNRU5UUwogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICQoZG9jdW1lbnQpCiAgICAub24oJ2NsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpJywgY2xlYXJNZW51cykKICAgIC5vbignY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGknLCAnLmRyb3Bkb3duIGZvcm0nLCBmdW5jdGlvbiAoZSkgeyBlLnN0b3BQcm9wYWdhdGlvbigpIH0pCiAgICAub24oJ2NsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpJywgdG9nZ2xlLCBEcm9wZG93bi5wcm90b3R5cGUudG9nZ2xlKQogICAgLm9uKCdrZXlkb3duLmJzLmRyb3Bkb3duLmRhdGEtYXBpJywgdG9nZ2xlLCBEcm9wZG93bi5wcm90b3R5cGUua2V5ZG93bikKICAgIC5vbigna2V5ZG93bi5icy5kcm9wZG93bi5kYXRhLWFwaScsICcuZHJvcGRvd24tbWVudScsIERyb3Bkb3duLnByb3RvdHlwZS5rZXlkb3duKQoKfShqUXVlcnkpOwoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIEJvb3RzdHJhcDogbW9kYWwuanMgdjMuMy41CiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI21vZGFscwogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQ29weXJpZ2h0IDIwMTEtMjAxNSBUd2l0dGVyLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKCitmdW5jdGlvbiAoJCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLy8gTU9EQUwgQ0xBU1MgREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT0KCiAgdmFyIE1vZGFsID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMub3B0aW9ucyAgICAgICAgICAgICA9IG9wdGlvbnMKICAgIHRoaXMuJGJvZHkgICAgICAgICAgICAgICA9ICQoZG9jdW1lbnQuYm9keSkKICAgIHRoaXMuJGVsZW1lbnQgICAgICAgICAgICA9ICQoZWxlbWVudCkKICAgIHRoaXMuJGRpYWxvZyAgICAgICAgICAgICA9IHRoaXMuJGVsZW1lbnQuZmluZCgnLm1vZGFsLWRpYWxvZycpCiAgICB0aGlzLiRiYWNrZHJvcCAgICAgICAgICAgPSBudWxsCiAgICB0aGlzLmlzU2hvd24gICAgICAgICAgICAgPSBudWxsCiAgICB0aGlzLm9yaWdpbmFsQm9keVBhZCAgICAgPSBudWxsCiAgICB0aGlzLnNjcm9sbGJhcldpZHRoICAgICAgPSAwCiAgICB0aGlzLmlnbm9yZUJhY2tkcm9wQ2xpY2sgPSBmYWxzZQoKICAgIGlmICh0aGlzLm9wdGlvbnMucmVtb3RlKSB7CiAgICAgIHRoaXMuJGVsZW1lbnQKICAgICAgICAuZmluZCgnLm1vZGFsLWNvbnRlbnQnKQogICAgICAgIC5sb2FkKHRoaXMub3B0aW9ucy5yZW1vdGUsICQucHJveHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKCdsb2FkZWQuYnMubW9kYWwnKQogICAgICAgIH0sIHRoaXMpKQogICAgfQogIH0KCiAgTW9kYWwuVkVSU0lPTiAgPSAnMy4zLjUnCgogIE1vZGFsLlRSQU5TSVRJT05fRFVSQVRJT04gPSAzMDAKICBNb2RhbC5CQUNLRFJPUF9UUkFOU0lUSU9OX0RVUkFUSU9OID0gMTUwCgogIE1vZGFsLkRFRkFVTFRTID0gewogICAgYmFja2Ryb3A6IHRydWUsCiAgICBrZXlib2FyZDogdHJ1ZSwKICAgIHNob3c6IHRydWUKICB9CgogIE1vZGFsLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoX3JlbGF0ZWRUYXJnZXQpIHsKICAgIHJldHVybiB0aGlzLmlzU2hvd24gPyB0aGlzLmhpZGUoKSA6IHRoaXMuc2hvdyhfcmVsYXRlZFRhcmdldCkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKF9yZWxhdGVkVGFyZ2V0KSB7CiAgICB2YXIgdGhhdCA9IHRoaXMKICAgIHZhciBlICAgID0gJC5FdmVudCgnc2hvdy5icy5tb2RhbCcsIHsgcmVsYXRlZFRhcmdldDogX3JlbGF0ZWRUYXJnZXQgfSkKCiAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSkKCiAgICBpZiAodGhpcy5pc1Nob3duIHx8IGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybgoKICAgIHRoaXMuaXNTaG93biA9IHRydWUKCiAgICB0aGlzLmNoZWNrU2Nyb2xsYmFyKCkKICAgIHRoaXMuc2V0U2Nyb2xsYmFyKCkKICAgIHRoaXMuJGJvZHkuYWRkQ2xhc3MoJ21vZGFsLW9wZW4nKQoKICAgIHRoaXMuZXNjYXBlKCkKICAgIHRoaXMucmVzaXplKCkKCiAgICB0aGlzLiRlbGVtZW50Lm9uKCdjbGljay5kaXNtaXNzLmJzLm1vZGFsJywgJ1tkYXRhLWRpc21pc3M9Im1vZGFsIl0nLCAkLnByb3h5KHRoaXMuaGlkZSwgdGhpcykpCgogICAgdGhpcy4kZGlhbG9nLm9uKCdtb3VzZWRvd24uZGlzbWlzcy5icy5tb2RhbCcsIGZ1bmN0aW9uICgpIHsKICAgICAgdGhhdC4kZWxlbWVudC5vbmUoJ21vdXNldXAuZGlzbWlzcy5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKCQoZS50YXJnZXQpLmlzKHRoYXQuJGVsZW1lbnQpKSB0aGF0Lmlnbm9yZUJhY2tkcm9wQ2xpY2sgPSB0cnVlCiAgICAgIH0pCiAgICB9KQoKICAgIHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24gKCkgewogICAgICB2YXIgdHJhbnNpdGlvbiA9ICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoYXQuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKQoKICAgICAgaWYgKCF0aGF0LiRlbGVtZW50LnBhcmVudCgpLmxlbmd0aCkgewogICAgICAgIHRoYXQuJGVsZW1lbnQuYXBwZW5kVG8odGhhdC4kYm9keSkgLy8gZG9uJ3QgbW92ZSBtb2RhbHMgZG9tIHBvc2l0aW9uCiAgICAgIH0KCiAgICAgIHRoYXQuJGVsZW1lbnQKICAgICAgICAuc2hvdygpCiAgICAgICAgLnNjcm9sbFRvcCgwKQoKICAgICAgdGhhdC5hZGp1c3REaWFsb2coKQoKICAgICAgaWYgKHRyYW5zaXRpb24pIHsKICAgICAgICB0aGF0LiRlbGVtZW50WzBdLm9mZnNldFdpZHRoIC8vIGZvcmNlIHJlZmxvdwogICAgICB9CgogICAgICB0aGF0LiRlbGVtZW50LmFkZENsYXNzKCdpbicpCgogICAgICB0aGF0LmVuZm9yY2VGb2N1cygpCgogICAgICB2YXIgZSA9ICQuRXZlbnQoJ3Nob3duLmJzLm1vZGFsJywgeyByZWxhdGVkVGFyZ2V0OiBfcmVsYXRlZFRhcmdldCB9KQoKICAgICAgdHJhbnNpdGlvbiA/CiAgICAgICAgdGhhdC4kZGlhbG9nIC8vIHdhaXQgZm9yIG1vZGFsIHRvIHNsaWRlIGluCiAgICAgICAgICAub25lKCdic1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoYXQuJGVsZW1lbnQudHJpZ2dlcignZm9jdXMnKS50cmlnZ2VyKGUpCiAgICAgICAgICB9KQogICAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKE1vZGFsLlRSQU5TSVRJT05fRFVSQVRJT04pIDoKICAgICAgICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2ZvY3VzJykudHJpZ2dlcihlKQogICAgfSkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKGUpIHsKICAgIGlmIChlKSBlLnByZXZlbnREZWZhdWx0KCkKCiAgICBlID0gJC5FdmVudCgnaGlkZS5icy5tb2RhbCcpCgogICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpCgogICAgaWYgKCF0aGlzLmlzU2hvd24gfHwgZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgdGhpcy5pc1Nob3duID0gZmFsc2UKCiAgICB0aGlzLmVzY2FwZSgpCiAgICB0aGlzLnJlc2l6ZSgpCgogICAgJChkb2N1bWVudCkub2ZmKCdmb2N1c2luLmJzLm1vZGFsJykKCiAgICB0aGlzLiRlbGVtZW50CiAgICAgIC5yZW1vdmVDbGFzcygnaW4nKQogICAgICAub2ZmKCdjbGljay5kaXNtaXNzLmJzLm1vZGFsJykKICAgICAgLm9mZignbW91c2V1cC5kaXNtaXNzLmJzLm1vZGFsJykKCiAgICB0aGlzLiRkaWFsb2cub2ZmKCdtb3VzZWRvd24uZGlzbWlzcy5icy5tb2RhbCcpCgogICAgJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnZmFkZScpID8KICAgICAgdGhpcy4kZWxlbWVudAogICAgICAgIC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsICQucHJveHkodGhpcy5oaWRlTW9kYWwsIHRoaXMpKQogICAgICAgIC5lbXVsYXRlVHJhbnNpdGlvbkVuZChNb2RhbC5UUkFOU0lUSU9OX0RVUkFUSU9OKSA6CiAgICAgIHRoaXMuaGlkZU1vZGFsKCkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5lbmZvcmNlRm9jdXMgPSBmdW5jdGlvbiAoKSB7CiAgICAkKGRvY3VtZW50KQogICAgICAub2ZmKCdmb2N1c2luLmJzLm1vZGFsJykgLy8gZ3VhcmQgYWdhaW5zdCBpbmZpbml0ZSBmb2N1cyBsb29wCiAgICAgIC5vbignZm9jdXNpbi5icy5tb2RhbCcsICQucHJveHkoZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAodGhpcy4kZWxlbWVudFswXSAhPT0gZS50YXJnZXQgJiYgIXRoaXMuJGVsZW1lbnQuaGFzKGUudGFyZ2V0KS5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcignZm9jdXMnKQogICAgICAgIH0KICAgICAgfSwgdGhpcykpCiAgfQoKICBNb2RhbC5wcm90b3R5cGUuZXNjYXBlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuaXNTaG93biAmJiB0aGlzLm9wdGlvbnMua2V5Ym9hcmQpIHsKICAgICAgdGhpcy4kZWxlbWVudC5vbigna2V5ZG93bi5kaXNtaXNzLmJzLm1vZGFsJywgJC5wcm94eShmdW5jdGlvbiAoZSkgewogICAgICAgIGUud2hpY2ggPT0gMjcgJiYgdGhpcy5oaWRlKCkKICAgICAgfSwgdGhpcykpCiAgICB9IGVsc2UgaWYgKCF0aGlzLmlzU2hvd24pIHsKICAgICAgdGhpcy4kZWxlbWVudC5vZmYoJ2tleWRvd24uZGlzbWlzcy5icy5tb2RhbCcpCiAgICB9CiAgfQoKICBNb2RhbC5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuaXNTaG93bikgewogICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZS5icy5tb2RhbCcsICQucHJveHkodGhpcy5oYW5kbGVVcGRhdGUsIHRoaXMpKQogICAgfSBlbHNlIHsKICAgICAgJCh3aW5kb3cpLm9mZigncmVzaXplLmJzLm1vZGFsJykKICAgIH0KICB9CgogIE1vZGFsLnByb3RvdHlwZS5oaWRlTW9kYWwgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgdGhhdCA9IHRoaXMKICAgIHRoaXMuJGVsZW1lbnQuaGlkZSgpCiAgICB0aGlzLmJhY2tkcm9wKGZ1bmN0aW9uICgpIHsKICAgICAgdGhhdC4kYm9keS5yZW1vdmVDbGFzcygnbW9kYWwtb3BlbicpCiAgICAgIHRoYXQucmVzZXRBZGp1c3RtZW50cygpCiAgICAgIHRoYXQucmVzZXRTY3JvbGxiYXIoKQogICAgICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2hpZGRlbi5icy5tb2RhbCcpCiAgICB9KQogIH0KCiAgTW9kYWwucHJvdG90eXBlLnJlbW92ZUJhY2tkcm9wID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy4kYmFja2Ryb3AgJiYgdGhpcy4kYmFja2Ryb3AucmVtb3ZlKCkKICAgIHRoaXMuJGJhY2tkcm9wID0gbnVsbAogIH0KCiAgTW9kYWwucHJvdG90eXBlLmJhY2tkcm9wID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICB2YXIgdGhhdCA9IHRoaXMKICAgIHZhciBhbmltYXRlID0gdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnZmFkZScpID8gJ2ZhZGUnIDogJycKCiAgICBpZiAodGhpcy5pc1Nob3duICYmIHRoaXMub3B0aW9ucy5iYWNrZHJvcCkgewogICAgICB2YXIgZG9BbmltYXRlID0gJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgYW5pbWF0ZQoKICAgICAgdGhpcy4kYmFja2Ryb3AgPSAkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKQogICAgICAgIC5hZGRDbGFzcygnbW9kYWwtYmFja2Ryb3AgJyArIGFuaW1hdGUpCiAgICAgICAgLmFwcGVuZFRvKHRoaXMuJGJvZHkpCgogICAgICB0aGlzLiRlbGVtZW50Lm9uKCdjbGljay5kaXNtaXNzLmJzLm1vZGFsJywgJC5wcm94eShmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICh0aGlzLmlnbm9yZUJhY2tkcm9wQ2xpY2spIHsKICAgICAgICAgIHRoaXMuaWdub3JlQmFja2Ryb3BDbGljayA9IGZhbHNlCiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgaWYgKGUudGFyZ2V0ICE9PSBlLmN1cnJlbnRUYXJnZXQpIHJldHVybgogICAgICAgIHRoaXMub3B0aW9ucy5iYWNrZHJvcCA9PSAnc3RhdGljJwogICAgICAgICAgPyB0aGlzLiRlbGVtZW50WzBdLmZvY3VzKCkKICAgICAgICAgIDogdGhpcy5oaWRlKCkKICAgICAgfSwgdGhpcykpCgogICAgICBpZiAoZG9BbmltYXRlKSB0aGlzLiRiYWNrZHJvcFswXS5vZmZzZXRXaWR0aCAvLyBmb3JjZSByZWZsb3cKCiAgICAgIHRoaXMuJGJhY2tkcm9wLmFkZENsYXNzKCdpbicpCgogICAgICBpZiAoIWNhbGxiYWNrKSByZXR1cm4KCiAgICAgIGRvQW5pbWF0ZSA/CiAgICAgICAgdGhpcy4kYmFja2Ryb3AKICAgICAgICAgIC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsIGNhbGxiYWNrKQogICAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKE1vZGFsLkJBQ0tEUk9QX1RSQU5TSVRJT05fRFVSQVRJT04pIDoKICAgICAgICBjYWxsYmFjaygpCgogICAgfSBlbHNlIGlmICghdGhpcy5pc1Nob3duICYmIHRoaXMuJGJhY2tkcm9wKSB7CiAgICAgIHRoaXMuJGJhY2tkcm9wLnJlbW92ZUNsYXNzKCdpbicpCgogICAgICB2YXIgY2FsbGJhY2tSZW1vdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhhdC5yZW1vdmVCYWNrZHJvcCgpCiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKQogICAgICB9CiAgICAgICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/CiAgICAgICAgdGhpcy4kYmFja2Ryb3AKICAgICAgICAgIC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsIGNhbGxiYWNrUmVtb3ZlKQogICAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKE1vZGFsLkJBQ0tEUk9QX1RSQU5TSVRJT05fRFVSQVRJT04pIDoKICAgICAgICBjYWxsYmFja1JlbW92ZSgpCgogICAgfSBlbHNlIGlmIChjYWxsYmFjaykgewogICAgICBjYWxsYmFjaygpCiAgICB9CiAgfQoKICAvLyB0aGVzZSBmb2xsb3dpbmcgbWV0aG9kcyBhcmUgdXNlZCB0byBoYW5kbGUgb3ZlcmZsb3dpbmcgbW9kYWxzCgogIE1vZGFsLnByb3RvdHlwZS5oYW5kbGVVcGRhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmFkanVzdERpYWxvZygpCiAgfQoKICBNb2RhbC5wcm90b3R5cGUuYWRqdXN0RGlhbG9nID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG1vZGFsSXNPdmVyZmxvd2luZyA9IHRoaXMuJGVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodAoKICAgIHRoaXMuJGVsZW1lbnQuY3NzKHsKICAgICAgcGFkZGluZ0xlZnQ6ICAhdGhpcy5ib2R5SXNPdmVyZmxvd2luZyAmJiBtb2RhbElzT3ZlcmZsb3dpbmcgPyB0aGlzLnNjcm9sbGJhcldpZHRoIDogJycsCiAgICAgIHBhZGRpbmdSaWdodDogdGhpcy5ib2R5SXNPdmVyZmxvd2luZyAmJiAhbW9kYWxJc092ZXJmbG93aW5nID8gdGhpcy5zY3JvbGxiYXJXaWR0aCA6ICcnCiAgICB9KQogIH0KCiAgTW9kYWwucHJvdG90eXBlLnJlc2V0QWRqdXN0bWVudHMgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLiRlbGVtZW50LmNzcyh7CiAgICAgIHBhZGRpbmdMZWZ0OiAnJywKICAgICAgcGFkZGluZ1JpZ2h0OiAnJwogICAgfSkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5jaGVja1Njcm9sbGJhciA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBmdWxsV2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aAogICAgaWYgKCFmdWxsV2luZG93V2lkdGgpIHsgLy8gd29ya2Fyb3VuZCBmb3IgbWlzc2luZyB3aW5kb3cuaW5uZXJXaWR0aCBpbiBJRTgKICAgICAgdmFyIGRvY3VtZW50RWxlbWVudFJlY3QgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKICAgICAgZnVsbFdpbmRvd1dpZHRoID0gZG9jdW1lbnRFbGVtZW50UmVjdC5yaWdodCAtIE1hdGguYWJzKGRvY3VtZW50RWxlbWVudFJlY3QubGVmdCkKICAgIH0KICAgIHRoaXMuYm9keUlzT3ZlcmZsb3dpbmcgPSBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIDwgZnVsbFdpbmRvd1dpZHRoCiAgICB0aGlzLnNjcm9sbGJhcldpZHRoID0gdGhpcy5tZWFzdXJlU2Nyb2xsYmFyKCkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5zZXRTY3JvbGxiYXIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgYm9keVBhZCA9IHBhcnNlSW50KCh0aGlzLiRib2R5LmNzcygncGFkZGluZy1yaWdodCcpIHx8IDApLCAxMCkKICAgIHRoaXMub3JpZ2luYWxCb2R5UGFkID0gZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nUmlnaHQgfHwgJycKICAgIGlmICh0aGlzLmJvZHlJc092ZXJmbG93aW5nKSB0aGlzLiRib2R5LmNzcygncGFkZGluZy1yaWdodCcsIGJvZHlQYWQgKyB0aGlzLnNjcm9sbGJhcldpZHRoKQogIH0KCiAgTW9kYWwucHJvdG90eXBlLnJlc2V0U2Nyb2xsYmFyID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy4kYm9keS5jc3MoJ3BhZGRpbmctcmlnaHQnLCB0aGlzLm9yaWdpbmFsQm9keVBhZCkKICB9CgogIE1vZGFsLnByb3RvdHlwZS5tZWFzdXJlU2Nyb2xsYmFyID0gZnVuY3Rpb24gKCkgeyAvLyB0aHggd2Fsc2gKICAgIHZhciBzY3JvbGxEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQogICAgc2Nyb2xsRGl2LmNsYXNzTmFtZSA9ICdtb2RhbC1zY3JvbGxiYXItbWVhc3VyZScKICAgIHRoaXMuJGJvZHkuYXBwZW5kKHNjcm9sbERpdikKICAgIHZhciBzY3JvbGxiYXJXaWR0aCA9IHNjcm9sbERpdi5vZmZzZXRXaWR0aCAtIHNjcm9sbERpdi5jbGllbnRXaWR0aAogICAgdGhpcy4kYm9keVswXS5yZW1vdmVDaGlsZChzY3JvbGxEaXYpCiAgICByZXR1cm4gc2Nyb2xsYmFyV2lkdGgKICB9CgoKICAvLyBNT0RBTCBQTFVHSU4gREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9uIFBsdWdpbihvcHRpb24sIF9yZWxhdGVkVGFyZ2V0KSB7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICR0aGlzICAgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhICAgID0gJHRoaXMuZGF0YSgnYnMubW9kYWwnKQogICAgICB2YXIgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBNb2RhbC5ERUZBVUxUUywgJHRoaXMuZGF0YSgpLCB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbikKCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMubW9kYWwnLCAoZGF0YSA9IG5ldyBNb2RhbCh0aGlzLCBvcHRpb25zKSkpCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oX3JlbGF0ZWRUYXJnZXQpCiAgICAgIGVsc2UgaWYgKG9wdGlvbnMuc2hvdykgZGF0YS5zaG93KF9yZWxhdGVkVGFyZ2V0KQogICAgfSkKICB9CgogIHZhciBvbGQgPSAkLmZuLm1vZGFsCgogICQuZm4ubW9kYWwgICAgICAgICAgICAgPSBQbHVnaW4KICAkLmZuLm1vZGFsLkNvbnN0cnVjdG9yID0gTW9kYWwKCgogIC8vIE1PREFMIE5PIENPTkZMSUNUCiAgLy8gPT09PT09PT09PT09PT09PT0KCiAgJC5mbi5tb2RhbC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbi5tb2RhbCA9IG9sZAogICAgcmV0dXJuIHRoaXMKICB9CgoKICAvLyBNT0RBTCBEQVRBLUFQSQogIC8vID09PT09PT09PT09PT09CgogICQoZG9jdW1lbnQpLm9uKCdjbGljay5icy5tb2RhbC5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9Im1vZGFsIl0nLCBmdW5jdGlvbiAoZSkgewogICAgdmFyICR0aGlzICAgPSAkKHRoaXMpCiAgICB2YXIgaHJlZiAgICA9ICR0aGlzLmF0dHIoJ2hyZWYnKQogICAgdmFyICR0YXJnZXQgPSAkKCR0aGlzLmF0dHIoJ2RhdGEtdGFyZ2V0JykgfHwgKGhyZWYgJiYgaHJlZi5yZXBsYWNlKC8uKig/PSNbXlxzXSskKS8sICcnKSkpIC8vIHN0cmlwIGZvciBpZTcKICAgIHZhciBvcHRpb24gID0gJHRhcmdldC5kYXRhKCdicy5tb2RhbCcpID8gJ3RvZ2dsZScgOiAkLmV4dGVuZCh7IHJlbW90ZTogIS8jLy50ZXN0KGhyZWYpICYmIGhyZWYgfSwgJHRhcmdldC5kYXRhKCksICR0aGlzLmRhdGEoKSkKCiAgICBpZiAoJHRoaXMuaXMoJ2EnKSkgZS5wcmV2ZW50RGVmYXVsdCgpCgogICAgJHRhcmdldC5vbmUoJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbiAoc2hvd0V2ZW50KSB7CiAgICAgIGlmIChzaG93RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybiAvLyBvbmx5IHJlZ2lzdGVyIGZvY3VzIHJlc3RvcmVyIGlmIG1vZGFsIHdpbGwgYWN0dWFsbHkgZ2V0IHNob3duCiAgICAgICR0YXJnZXQub25lKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgJHRoaXMuaXMoJzp2aXNpYmxlJykgJiYgJHRoaXMudHJpZ2dlcignZm9jdXMnKQogICAgICB9KQogICAgfSkKICAgIFBsdWdpbi5jYWxsKCR0YXJnZXQsIG9wdGlvbiwgdGhpcykKICB9KQoKfShqUXVlcnkpOwoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIEJvb3RzdHJhcDogdG9vbHRpcC5qcyB2My4zLjUKICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jdG9vbHRpcAogKiBJbnNwaXJlZCBieSB0aGUgb3JpZ2luYWwgalF1ZXJ5LnRpcHN5IGJ5IEphc29uIEZyYW1lCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQgMjAxMS0yMDE1IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgoKK2Z1bmN0aW9uICgkKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBUT09MVElQIFBVQkxJQyBDTEFTUyBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICB2YXIgVG9vbHRpcCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0aGlzLnR5cGUgICAgICAgPSBudWxsCiAgICB0aGlzLm9wdGlvbnMgICAgPSBudWxsCiAgICB0aGlzLmVuYWJsZWQgICAgPSBudWxsCiAgICB0aGlzLnRpbWVvdXQgICAgPSBudWxsCiAgICB0aGlzLmhvdmVyU3RhdGUgPSBudWxsCiAgICB0aGlzLiRlbGVtZW50ICAgPSBudWxsCiAgICB0aGlzLmluU3RhdGUgICAgPSBudWxsCgogICAgdGhpcy5pbml0KCd0b29sdGlwJywgZWxlbWVudCwgb3B0aW9ucykKICB9CgogIFRvb2x0aXAuVkVSU0lPTiAgPSAnMy4zLjUnCgogIFRvb2x0aXAuVFJBTlNJVElPTl9EVVJBVElPTiA9IDE1MAoKICBUb29sdGlwLkRFRkFVTFRTID0gewogICAgYW5pbWF0aW9uOiB0cnVlLAogICAgcGxhY2VtZW50OiAndG9wJywKICAgIHNlbGVjdG9yOiBmYWxzZSwKICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0idG9vbHRpcCIgcm9sZT0idG9vbHRpcCI+PGRpdiBjbGFzcz0idG9vbHRpcC1hcnJvdyI+PC9kaXY+PGRpdiBjbGFzcz0idG9vbHRpcC1pbm5lciI+PC9kaXY+PC9kaXY+JywKICAgIHRyaWdnZXI6ICdob3ZlciBmb2N1cycsCiAgICB0aXRsZTogJycsCiAgICBkZWxheTogMCwKICAgIGh0bWw6IGZhbHNlLAogICAgY29udGFpbmVyOiBmYWxzZSwKICAgIHZpZXdwb3J0OiB7CiAgICAgIHNlbGVjdG9yOiAnYm9keScsCiAgICAgIHBhZGRpbmc6IDAKICAgIH0KICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAodHlwZSwgZWxlbWVudCwgb3B0aW9ucykgewogICAgdGhpcy5lbmFibGVkICAgPSB0cnVlCiAgICB0aGlzLnR5cGUgICAgICA9IHR5cGUKICAgIHRoaXMuJGVsZW1lbnQgID0gJChlbGVtZW50KQogICAgdGhpcy5vcHRpb25zICAgPSB0aGlzLmdldE9wdGlvbnMob3B0aW9ucykKICAgIHRoaXMuJHZpZXdwb3J0ID0gdGhpcy5vcHRpb25zLnZpZXdwb3J0ICYmICQoJC5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy52aWV3cG9ydCkgPyB0aGlzLm9wdGlvbnMudmlld3BvcnQuY2FsbCh0aGlzLCB0aGlzLiRlbGVtZW50KSA6ICh0aGlzLm9wdGlvbnMudmlld3BvcnQuc2VsZWN0b3IgfHwgdGhpcy5vcHRpb25zLnZpZXdwb3J0KSkKICAgIHRoaXMuaW5TdGF0ZSAgID0geyBjbGljazogZmFsc2UsIGhvdmVyOiBmYWxzZSwgZm9jdXM6IGZhbHNlIH0KCiAgICBpZiAodGhpcy4kZWxlbWVudFswXSBpbnN0YW5jZW9mIGRvY3VtZW50LmNvbnN0cnVjdG9yICYmICF0aGlzLm9wdGlvbnMuc2VsZWN0b3IpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdgc2VsZWN0b3JgIG9wdGlvbiBtdXN0IGJlIHNwZWNpZmllZCB3aGVuIGluaXRpYWxpemluZyAnICsgdGhpcy50eXBlICsgJyBvbiB0aGUgd2luZG93LmRvY3VtZW50IG9iamVjdCEnKQogICAgfQoKICAgIHZhciB0cmlnZ2VycyA9IHRoaXMub3B0aW9ucy50cmlnZ2VyLnNwbGl0KCcgJykKCiAgICBmb3IgKHZhciBpID0gdHJpZ2dlcnMubGVuZ3RoOyBpLS07KSB7CiAgICAgIHZhciB0cmlnZ2VyID0gdHJpZ2dlcnNbaV0KCiAgICAgIGlmICh0cmlnZ2VyID09ICdjbGljaycpIHsKICAgICAgICB0aGlzLiRlbGVtZW50Lm9uKCdjbGljay4nICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsICQucHJveHkodGhpcy50b2dnbGUsIHRoaXMpKQogICAgICB9IGVsc2UgaWYgKHRyaWdnZXIgIT0gJ21hbnVhbCcpIHsKICAgICAgICB2YXIgZXZlbnRJbiAgPSB0cmlnZ2VyID09ICdob3ZlcicgPyAnbW91c2VlbnRlcicgOiAnZm9jdXNpbicKICAgICAgICB2YXIgZXZlbnRPdXQgPSB0cmlnZ2VyID09ICdob3ZlcicgPyAnbW91c2VsZWF2ZScgOiAnZm9jdXNvdXQnCgogICAgICAgIHRoaXMuJGVsZW1lbnQub24oZXZlbnRJbiAgKyAnLicgKyB0aGlzLnR5cGUsIHRoaXMub3B0aW9ucy5zZWxlY3RvciwgJC5wcm94eSh0aGlzLmVudGVyLCB0aGlzKSkKICAgICAgICB0aGlzLiRlbGVtZW50Lm9uKGV2ZW50T3V0ICsgJy4nICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsICQucHJveHkodGhpcy5sZWF2ZSwgdGhpcykpCiAgICAgIH0KICAgIH0KCiAgICB0aGlzLm9wdGlvbnMuc2VsZWN0b3IgPwogICAgICAodGhpcy5fb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIHsgdHJpZ2dlcjogJ21hbnVhbCcsIHNlbGVjdG9yOiAnJyB9KSkgOgogICAgICB0aGlzLmZpeFRpdGxlKCkKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmdldERlZmF1bHRzID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFRvb2x0aXAuREVGQVVMVFMKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmdldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB0aGlzLmdldERlZmF1bHRzKCksIHRoaXMuJGVsZW1lbnQuZGF0YSgpLCBvcHRpb25zKQoKICAgIGlmIChvcHRpb25zLmRlbGF5ICYmIHR5cGVvZiBvcHRpb25zLmRlbGF5ID09ICdudW1iZXInKSB7CiAgICAgIG9wdGlvbnMuZGVsYXkgPSB7CiAgICAgICAgc2hvdzogb3B0aW9ucy5kZWxheSwKICAgICAgICBoaWRlOiBvcHRpb25zLmRlbGF5CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb3B0aW9ucwogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuZ2V0RGVsZWdhdGVPcHRpb25zID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG9wdGlvbnMgID0ge30KICAgIHZhciBkZWZhdWx0cyA9IHRoaXMuZ2V0RGVmYXVsdHMoKQoKICAgIHRoaXMuX29wdGlvbnMgJiYgJC5lYWNoKHRoaXMuX29wdGlvbnMsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgIGlmIChkZWZhdWx0c1trZXldICE9IHZhbHVlKSBvcHRpb25zW2tleV0gPSB2YWx1ZQogICAgfSkKCiAgICByZXR1cm4gb3B0aW9ucwogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuZW50ZXIgPSBmdW5jdGlvbiAob2JqKSB7CiAgICB2YXIgc2VsZiA9IG9iaiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3IgPwogICAgICBvYmogOiAkKG9iai5jdXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50eXBlKQoKICAgIGlmICghc2VsZikgewogICAgICBzZWxmID0gbmV3IHRoaXMuY29uc3RydWN0b3Iob2JqLmN1cnJlbnRUYXJnZXQsIHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpCiAgICAgICQob2JqLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUsIHNlbGYpCiAgICB9CgogICAgaWYgKG9iaiBpbnN0YW5jZW9mICQuRXZlbnQpIHsKICAgICAgc2VsZi5pblN0YXRlW29iai50eXBlID09ICdmb2N1c2luJyA/ICdmb2N1cycgOiAnaG92ZXInXSA9IHRydWUKICAgIH0KCiAgICBpZiAoc2VsZi50aXAoKS5oYXNDbGFzcygnaW4nKSB8fCBzZWxmLmhvdmVyU3RhdGUgPT0gJ2luJykgewogICAgICBzZWxmLmhvdmVyU3RhdGUgPSAnaW4nCiAgICAgIHJldHVybgogICAgfQoKICAgIGNsZWFyVGltZW91dChzZWxmLnRpbWVvdXQpCgogICAgc2VsZi5ob3ZlclN0YXRlID0gJ2luJwoKICAgIGlmICghc2VsZi5vcHRpb25zLmRlbGF5IHx8ICFzZWxmLm9wdGlvbnMuZGVsYXkuc2hvdykgcmV0dXJuIHNlbGYuc2hvdygpCgogICAgc2VsZi50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChzZWxmLmhvdmVyU3RhdGUgPT0gJ2luJykgc2VsZi5zaG93KCkKICAgIH0sIHNlbGYub3B0aW9ucy5kZWxheS5zaG93KQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuaXNJblN0YXRlVHJ1ZSA9IGZ1bmN0aW9uICgpIHsKICAgIGZvciAodmFyIGtleSBpbiB0aGlzLmluU3RhdGUpIHsKICAgICAgaWYgKHRoaXMuaW5TdGF0ZVtrZXldKSByZXR1cm4gdHJ1ZQogICAgfQoKICAgIHJldHVybiBmYWxzZQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUubGVhdmUgPSBmdW5jdGlvbiAob2JqKSB7CiAgICB2YXIgc2VsZiA9IG9iaiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3IgPwogICAgICBvYmogOiAkKG9iai5jdXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50eXBlKQoKICAgIGlmICghc2VsZikgewogICAgICBzZWxmID0gbmV3IHRoaXMuY29uc3RydWN0b3Iob2JqLmN1cnJlbnRUYXJnZXQsIHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpCiAgICAgICQob2JqLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUsIHNlbGYpCiAgICB9CgogICAgaWYgKG9iaiBpbnN0YW5jZW9mICQuRXZlbnQpIHsKICAgICAgc2VsZi5pblN0YXRlW29iai50eXBlID09ICdmb2N1c291dCcgPyAnZm9jdXMnIDogJ2hvdmVyJ10gPSBmYWxzZQogICAgfQoKICAgIGlmIChzZWxmLmlzSW5TdGF0ZVRydWUoKSkgcmV0dXJuCgogICAgY2xlYXJUaW1lb3V0KHNlbGYudGltZW91dCkKCiAgICBzZWxmLmhvdmVyU3RhdGUgPSAnb3V0JwoKICAgIGlmICghc2VsZi5vcHRpb25zLmRlbGF5IHx8ICFzZWxmLm9wdGlvbnMuZGVsYXkuaGlkZSkgcmV0dXJuIHNlbGYuaGlkZSgpCgogICAgc2VsZi50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChzZWxmLmhvdmVyU3RhdGUgPT0gJ291dCcpIHNlbGYuaGlkZSgpCiAgICB9LCBzZWxmLm9wdGlvbnMuZGVsYXkuaGlkZSkKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZSA9ICQuRXZlbnQoJ3Nob3cuYnMuJyArIHRoaXMudHlwZSkKCiAgICBpZiAodGhpcy5oYXNDb250ZW50KCkgJiYgdGhpcy5lbmFibGVkKSB7CiAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihlKQoKICAgICAgdmFyIGluRG9tID0gJC5jb250YWlucyh0aGlzLiRlbGVtZW50WzBdLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCB0aGlzLiRlbGVtZW50WzBdKQogICAgICBpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSB8fCAhaW5Eb20pIHJldHVybgogICAgICB2YXIgdGhhdCA9IHRoaXMKCiAgICAgIHZhciAkdGlwID0gdGhpcy50aXAoKQoKICAgICAgdmFyIHRpcElkID0gdGhpcy5nZXRVSUQodGhpcy50eXBlKQoKICAgICAgdGhpcy5zZXRDb250ZW50KCkKICAgICAgJHRpcC5hdHRyKCdpZCcsIHRpcElkKQogICAgICB0aGlzLiRlbGVtZW50LmF0dHIoJ2FyaWEtZGVzY3JpYmVkYnknLCB0aXBJZCkKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYW5pbWF0aW9uKSAkdGlwLmFkZENsYXNzKCdmYWRlJykKCiAgICAgIHZhciBwbGFjZW1lbnQgPSB0eXBlb2YgdGhpcy5vcHRpb25zLnBsYWNlbWVudCA9PSAnZnVuY3Rpb24nID8KICAgICAgICB0aGlzLm9wdGlvbnMucGxhY2VtZW50LmNhbGwodGhpcywgJHRpcFswXSwgdGhpcy4kZWxlbWVudFswXSkgOgogICAgICAgIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQKCiAgICAgIHZhciBhdXRvVG9rZW4gPSAvXHM/YXV0bz9ccz8vaQogICAgICB2YXIgYXV0b1BsYWNlID0gYXV0b1Rva2VuLnRlc3QocGxhY2VtZW50KQogICAgICBpZiAoYXV0b1BsYWNlKSBwbGFjZW1lbnQgPSBwbGFjZW1lbnQucmVwbGFjZShhdXRvVG9rZW4sICcnKSB8fCAndG9wJwoKICAgICAgJHRpcAogICAgICAgIC5kZXRhY2goKQogICAgICAgIC5jc3MoeyB0b3A6IDAsIGxlZnQ6IDAsIGRpc3BsYXk6ICdibG9jaycgfSkKICAgICAgICAuYWRkQ2xhc3MocGxhY2VtZW50KQogICAgICAgIC5kYXRhKCdicy4nICsgdGhpcy50eXBlLCB0aGlzKQoKICAgICAgdGhpcy5vcHRpb25zLmNvbnRhaW5lciA/ICR0aXAuYXBwZW5kVG8odGhpcy5vcHRpb25zLmNvbnRhaW5lcikgOiAkdGlwLmluc2VydEFmdGVyKHRoaXMuJGVsZW1lbnQpCiAgICAgIHRoaXMuJGVsZW1lbnQudHJpZ2dlcignaW5zZXJ0ZWQuYnMuJyArIHRoaXMudHlwZSkKCiAgICAgIHZhciBwb3MgICAgICAgICAgPSB0aGlzLmdldFBvc2l0aW9uKCkKICAgICAgdmFyIGFjdHVhbFdpZHRoICA9ICR0aXBbMF0ub2Zmc2V0V2lkdGgKICAgICAgdmFyIGFjdHVhbEhlaWdodCA9ICR0aXBbMF0ub2Zmc2V0SGVpZ2h0CgogICAgICBpZiAoYXV0b1BsYWNlKSB7CiAgICAgICAgdmFyIG9yZ1BsYWNlbWVudCA9IHBsYWNlbWVudAogICAgICAgIHZhciB2aWV3cG9ydERpbSA9IHRoaXMuZ2V0UG9zaXRpb24odGhpcy4kdmlld3BvcnQpCgogICAgICAgIHBsYWNlbWVudCA9IHBsYWNlbWVudCA9PSAnYm90dG9tJyAmJiBwb3MuYm90dG9tICsgYWN0dWFsSGVpZ2h0ID4gdmlld3BvcnREaW0uYm90dG9tID8gJ3RvcCcgICAgOgogICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9PSAndG9wJyAgICAmJiBwb3MudG9wICAgIC0gYWN0dWFsSGVpZ2h0IDwgdmlld3BvcnREaW0udG9wICAgID8gJ2JvdHRvbScgOgogICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9PSAncmlnaHQnICAmJiBwb3MucmlnaHQgICsgYWN0dWFsV2lkdGggID4gdmlld3BvcnREaW0ud2lkdGggID8gJ2xlZnQnICAgOgogICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudCA9PSAnbGVmdCcgICAmJiBwb3MubGVmdCAgIC0gYWN0dWFsV2lkdGggIDwgdmlld3BvcnREaW0ubGVmdCAgID8gJ3JpZ2h0JyAgOgogICAgICAgICAgICAgICAgICAgIHBsYWNlbWVudAoKICAgICAgICAkdGlwCiAgICAgICAgICAucmVtb3ZlQ2xhc3Mob3JnUGxhY2VtZW50KQogICAgICAgICAgLmFkZENsYXNzKHBsYWNlbWVudCkKICAgICAgfQoKICAgICAgdmFyIGNhbGN1bGF0ZWRPZmZzZXQgPSB0aGlzLmdldENhbGN1bGF0ZWRPZmZzZXQocGxhY2VtZW50LCBwb3MsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQpCgogICAgICB0aGlzLmFwcGx5UGxhY2VtZW50KGNhbGN1bGF0ZWRPZmZzZXQsIHBsYWNlbWVudCkKCiAgICAgIHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcHJldkhvdmVyU3RhdGUgPSB0aGF0LmhvdmVyU3RhdGUKICAgICAgICB0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ3Nob3duLmJzLicgKyB0aGF0LnR5cGUpCiAgICAgICAgdGhhdC5ob3ZlclN0YXRlID0gbnVsbAoKICAgICAgICBpZiAocHJldkhvdmVyU3RhdGUgPT0gJ291dCcpIHRoYXQubGVhdmUodGhhdCkKICAgICAgfQoKICAgICAgJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kdGlwLmhhc0NsYXNzKCdmYWRlJykgPwogICAgICAgICR0aXAKICAgICAgICAgIC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsIGNvbXBsZXRlKQogICAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKFRvb2x0aXAuVFJBTlNJVElPTl9EVVJBVElPTikgOgogICAgICAgIGNvbXBsZXRlKCkKICAgIH0KICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmFwcGx5UGxhY2VtZW50ID0gZnVuY3Rpb24gKG9mZnNldCwgcGxhY2VtZW50KSB7CiAgICB2YXIgJHRpcCAgID0gdGhpcy50aXAoKQogICAgdmFyIHdpZHRoICA9ICR0aXBbMF0ub2Zmc2V0V2lkdGgKICAgIHZhciBoZWlnaHQgPSAkdGlwWzBdLm9mZnNldEhlaWdodAoKICAgIC8vIG1hbnVhbGx5IHJlYWQgbWFyZ2lucyBiZWNhdXNlIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBpbmNsdWRlcyBkaWZmZXJlbmNlCiAgICB2YXIgbWFyZ2luVG9wID0gcGFyc2VJbnQoJHRpcC5jc3MoJ21hcmdpbi10b3AnKSwgMTApCiAgICB2YXIgbWFyZ2luTGVmdCA9IHBhcnNlSW50KCR0aXAuY3NzKCdtYXJnaW4tbGVmdCcpLCAxMCkKCiAgICAvLyB3ZSBtdXN0IGNoZWNrIGZvciBOYU4gZm9yIGllIDgvOQogICAgaWYgKGlzTmFOKG1hcmdpblRvcCkpICBtYXJnaW5Ub3AgID0gMAogICAgaWYgKGlzTmFOKG1hcmdpbkxlZnQpKSBtYXJnaW5MZWZ0ID0gMAoKICAgIG9mZnNldC50b3AgICs9IG1hcmdpblRvcAogICAgb2Zmc2V0LmxlZnQgKz0gbWFyZ2luTGVmdAoKICAgIC8vICQuZm4ub2Zmc2V0IGRvZXNuJ3Qgcm91bmQgcGl4ZWwgdmFsdWVzCiAgICAvLyBzbyB3ZSB1c2Ugc2V0T2Zmc2V0IGRpcmVjdGx5IHdpdGggb3VyIG93biBmdW5jdGlvbiBCLTAKICAgICQub2Zmc2V0LnNldE9mZnNldCgkdGlwWzBdLCAkLmV4dGVuZCh7CiAgICAgIHVzaW5nOiBmdW5jdGlvbiAocHJvcHMpIHsKICAgICAgICAkdGlwLmNzcyh7CiAgICAgICAgICB0b3A6IE1hdGgucm91bmQocHJvcHMudG9wKSwKICAgICAgICAgIGxlZnQ6IE1hdGgucm91bmQocHJvcHMubGVmdCkKICAgICAgICB9KQogICAgICB9CiAgICB9LCBvZmZzZXQpLCAwKQoKICAgICR0aXAuYWRkQ2xhc3MoJ2luJykKCiAgICAvLyBjaGVjayB0byBzZWUgaWYgcGxhY2luZyB0aXAgaW4gbmV3IG9mZnNldCBjYXVzZWQgdGhlIHRpcCB0byByZXNpemUgaXRzZWxmCiAgICB2YXIgYWN0dWFsV2lkdGggID0gJHRpcFswXS5vZmZzZXRXaWR0aAogICAgdmFyIGFjdHVhbEhlaWdodCA9ICR0aXBbMF0ub2Zmc2V0SGVpZ2h0CgogICAgaWYgKHBsYWNlbWVudCA9PSAndG9wJyAmJiBhY3R1YWxIZWlnaHQgIT0gaGVpZ2h0KSB7CiAgICAgIG9mZnNldC50b3AgPSBvZmZzZXQudG9wICsgaGVpZ2h0IC0gYWN0dWFsSGVpZ2h0CiAgICB9CgogICAgdmFyIGRlbHRhID0gdGhpcy5nZXRWaWV3cG9ydEFkanVzdGVkRGVsdGEocGxhY2VtZW50LCBvZmZzZXQsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQpCgogICAgaWYgKGRlbHRhLmxlZnQpIG9mZnNldC5sZWZ0ICs9IGRlbHRhLmxlZnQKICAgIGVsc2Ugb2Zmc2V0LnRvcCArPSBkZWx0YS50b3AKCiAgICB2YXIgaXNWZXJ0aWNhbCAgICAgICAgICA9IC90b3B8Ym90dG9tLy50ZXN0KHBsYWNlbWVudCkKICAgIHZhciBhcnJvd0RlbHRhICAgICAgICAgID0gaXNWZXJ0aWNhbCA/IGRlbHRhLmxlZnQgKiAyIC0gd2lkdGggKyBhY3R1YWxXaWR0aCA6IGRlbHRhLnRvcCAqIDIgLSBoZWlnaHQgKyBhY3R1YWxIZWlnaHQKICAgIHZhciBhcnJvd09mZnNldFBvc2l0aW9uID0gaXNWZXJ0aWNhbCA/ICdvZmZzZXRXaWR0aCcgOiAnb2Zmc2V0SGVpZ2h0JwoKICAgICR0aXAub2Zmc2V0KG9mZnNldCkKICAgIHRoaXMucmVwbGFjZUFycm93KGFycm93RGVsdGEsICR0aXBbMF1bYXJyb3dPZmZzZXRQb3NpdGlvbl0sIGlzVmVydGljYWwpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5yZXBsYWNlQXJyb3cgPSBmdW5jdGlvbiAoZGVsdGEsIGRpbWVuc2lvbiwgaXNWZXJ0aWNhbCkgewogICAgdGhpcy5hcnJvdygpCiAgICAgIC5jc3MoaXNWZXJ0aWNhbCA/ICdsZWZ0JyA6ICd0b3AnLCA1MCAqICgxIC0gZGVsdGEgLyBkaW1lbnNpb24pICsgJyUnKQogICAgICAuY3NzKGlzVmVydGljYWwgPyAndG9wJyA6ICdsZWZ0JywgJycpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5zZXRDb250ZW50ID0gZnVuY3Rpb24gKCkgewogICAgdmFyICR0aXAgID0gdGhpcy50aXAoKQogICAgdmFyIHRpdGxlID0gdGhpcy5nZXRUaXRsZSgpCgogICAgJHRpcC5maW5kKCcudG9vbHRpcC1pbm5lcicpW3RoaXMub3B0aW9ucy5odG1sID8gJ2h0bWwnIDogJ3RleHQnXSh0aXRsZSkKICAgICR0aXAucmVtb3ZlQ2xhc3MoJ2ZhZGUgaW4gdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0JykKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIHZhciB0aGF0ID0gdGhpcwogICAgdmFyICR0aXAgPSAkKHRoaXMuJHRpcCkKICAgIHZhciBlICAgID0gJC5FdmVudCgnaGlkZS5icy4nICsgdGhpcy50eXBlKQoKICAgIGZ1bmN0aW9uIGNvbXBsZXRlKCkgewogICAgICBpZiAodGhhdC5ob3ZlclN0YXRlICE9ICdpbicpICR0aXAuZGV0YWNoKCkKICAgICAgdGhhdC4kZWxlbWVudAogICAgICAgIC5yZW1vdmVBdHRyKCdhcmlhLWRlc2NyaWJlZGJ5JykKICAgICAgICAudHJpZ2dlcignaGlkZGVuLmJzLicgKyB0aGF0LnR5cGUpCiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCkKICAgIH0KCiAgICB0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSkKCiAgICBpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgJHRpcC5yZW1vdmVDbGFzcygnaW4nKQoKICAgICQuc3VwcG9ydC50cmFuc2l0aW9uICYmICR0aXAuaGFzQ2xhc3MoJ2ZhZGUnKSA/CiAgICAgICR0aXAKICAgICAgICAub25lKCdic1RyYW5zaXRpb25FbmQnLCBjb21wbGV0ZSkKICAgICAgICAuZW11bGF0ZVRyYW5zaXRpb25FbmQoVG9vbHRpcC5UUkFOU0lUSU9OX0RVUkFUSU9OKSA6CiAgICAgIGNvbXBsZXRlKCkKCiAgICB0aGlzLmhvdmVyU3RhdGUgPSBudWxsCgogICAgcmV0dXJuIHRoaXMKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmZpeFRpdGxlID0gZnVuY3Rpb24gKCkgewogICAgdmFyICRlID0gdGhpcy4kZWxlbWVudAogICAgaWYgKCRlLmF0dHIoJ3RpdGxlJykgfHwgdHlwZW9mICRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnKSAhPSAnc3RyaW5nJykgewogICAgICAkZS5hdHRyKCdkYXRhLW9yaWdpbmFsLXRpdGxlJywgJGUuYXR0cigndGl0bGUnKSB8fCAnJykuYXR0cigndGl0bGUnLCAnJykKICAgIH0KICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmhhc0NvbnRlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5nZXRUaXRsZSgpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uICgkZWxlbWVudCkgewogICAgJGVsZW1lbnQgICA9ICRlbGVtZW50IHx8IHRoaXMuJGVsZW1lbnQKCiAgICB2YXIgZWwgICAgID0gJGVsZW1lbnRbMF0KICAgIHZhciBpc0JvZHkgPSBlbC50YWdOYW1lID09ICdCT0RZJwoKICAgIHZhciBlbFJlY3QgICAgPSBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQogICAgaWYgKGVsUmVjdC53aWR0aCA9PSBudWxsKSB7CiAgICAgIC8vIHdpZHRoIGFuZCBoZWlnaHQgYXJlIG1pc3NpbmcgaW4gSUU4LCBzbyBjb21wdXRlIHRoZW0gbWFudWFsbHk7IHNlZSBodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvaXNzdWVzLzE0MDkzCiAgICAgIGVsUmVjdCA9ICQuZXh0ZW5kKHt9LCBlbFJlY3QsIHsgd2lkdGg6IGVsUmVjdC5yaWdodCAtIGVsUmVjdC5sZWZ0LCBoZWlnaHQ6IGVsUmVjdC5ib3R0b20gLSBlbFJlY3QudG9wIH0pCiAgICB9CiAgICB2YXIgZWxPZmZzZXQgID0gaXNCb2R5ID8geyB0b3A6IDAsIGxlZnQ6IDAgfSA6ICRlbGVtZW50Lm9mZnNldCgpCiAgICB2YXIgc2Nyb2xsICAgID0geyBzY3JvbGw6IGlzQm9keSA/IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgOiAkZWxlbWVudC5zY3JvbGxUb3AoKSB9CiAgICB2YXIgb3V0ZXJEaW1zID0gaXNCb2R5ID8geyB3aWR0aDogJCh3aW5kb3cpLndpZHRoKCksIGhlaWdodDogJCh3aW5kb3cpLmhlaWdodCgpIH0gOiBudWxsCgogICAgcmV0dXJuICQuZXh0ZW5kKHt9LCBlbFJlY3QsIHNjcm9sbCwgb3V0ZXJEaW1zLCBlbE9mZnNldCkKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLmdldENhbGN1bGF0ZWRPZmZzZXQgPSBmdW5jdGlvbiAocGxhY2VtZW50LCBwb3MsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQpIHsKICAgIHJldHVybiBwbGFjZW1lbnQgPT0gJ2JvdHRvbScgPyB7IHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQsICAgbGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGggLyAyIC0gYWN0dWFsV2lkdGggLyAyIH0gOgogICAgICAgICAgIHBsYWNlbWVudCA9PSAndG9wJyAgICA/IHsgdG9wOiBwb3MudG9wIC0gYWN0dWFsSGVpZ2h0LCBsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aCAvIDIgLSBhY3R1YWxXaWR0aCAvIDIgfSA6CiAgICAgICAgICAgcGxhY2VtZW50ID09ICdsZWZ0JyAgID8geyB0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIGFjdHVhbEhlaWdodCAvIDIsIGxlZnQ6IHBvcy5sZWZ0IC0gYWN0dWFsV2lkdGggfSA6CiAgICAgICAgLyogcGxhY2VtZW50ID09ICdyaWdodCcgKi8geyB0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIGFjdHVhbEhlaWdodCAvIDIsIGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoIH0KCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5nZXRWaWV3cG9ydEFkanVzdGVkRGVsdGEgPSBmdW5jdGlvbiAocGxhY2VtZW50LCBwb3MsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQpIHsKICAgIHZhciBkZWx0YSA9IHsgdG9wOiAwLCBsZWZ0OiAwIH0KICAgIGlmICghdGhpcy4kdmlld3BvcnQpIHJldHVybiBkZWx0YQoKICAgIHZhciB2aWV3cG9ydFBhZGRpbmcgPSB0aGlzLm9wdGlvbnMudmlld3BvcnQgJiYgdGhpcy5vcHRpb25zLnZpZXdwb3J0LnBhZGRpbmcgfHwgMAogICAgdmFyIHZpZXdwb3J0RGltZW5zaW9ucyA9IHRoaXMuZ2V0UG9zaXRpb24odGhpcy4kdmlld3BvcnQpCgogICAgaWYgKC9yaWdodHxsZWZ0Ly50ZXN0KHBsYWNlbWVudCkpIHsKICAgICAgdmFyIHRvcEVkZ2VPZmZzZXQgICAgPSBwb3MudG9wIC0gdmlld3BvcnRQYWRkaW5nIC0gdmlld3BvcnREaW1lbnNpb25zLnNjcm9sbAogICAgICB2YXIgYm90dG9tRWRnZU9mZnNldCA9IHBvcy50b3AgKyB2aWV3cG9ydFBhZGRpbmcgLSB2aWV3cG9ydERpbWVuc2lvbnMuc2Nyb2xsICsgYWN0dWFsSGVpZ2h0CiAgICAgIGlmICh0b3BFZGdlT2Zmc2V0IDwgdmlld3BvcnREaW1lbnNpb25zLnRvcCkgeyAvLyB0b3Agb3ZlcmZsb3cKICAgICAgICBkZWx0YS50b3AgPSB2aWV3cG9ydERpbWVuc2lvbnMudG9wIC0gdG9wRWRnZU9mZnNldAogICAgICB9IGVsc2UgaWYgKGJvdHRvbUVkZ2VPZmZzZXQgPiB2aWV3cG9ydERpbWVuc2lvbnMudG9wICsgdmlld3BvcnREaW1lbnNpb25zLmhlaWdodCkgeyAvLyBib3R0b20gb3ZlcmZsb3cKICAgICAgICBkZWx0YS50b3AgPSB2aWV3cG9ydERpbWVuc2lvbnMudG9wICsgdmlld3BvcnREaW1lbnNpb25zLmhlaWdodCAtIGJvdHRvbUVkZ2VPZmZzZXQKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGxlZnRFZGdlT2Zmc2V0ICA9IHBvcy5sZWZ0IC0gdmlld3BvcnRQYWRkaW5nCiAgICAgIHZhciByaWdodEVkZ2VPZmZzZXQgPSBwb3MubGVmdCArIHZpZXdwb3J0UGFkZGluZyArIGFjdHVhbFdpZHRoCiAgICAgIGlmIChsZWZ0RWRnZU9mZnNldCA8IHZpZXdwb3J0RGltZW5zaW9ucy5sZWZ0KSB7IC8vIGxlZnQgb3ZlcmZsb3cKICAgICAgICBkZWx0YS5sZWZ0ID0gdmlld3BvcnREaW1lbnNpb25zLmxlZnQgLSBsZWZ0RWRnZU9mZnNldAogICAgICB9IGVsc2UgaWYgKHJpZ2h0RWRnZU9mZnNldCA+IHZpZXdwb3J0RGltZW5zaW9ucy5yaWdodCkgeyAvLyByaWdodCBvdmVyZmxvdwogICAgICAgIGRlbHRhLmxlZnQgPSB2aWV3cG9ydERpbWVuc2lvbnMubGVmdCArIHZpZXdwb3J0RGltZW5zaW9ucy53aWR0aCAtIHJpZ2h0RWRnZU9mZnNldAogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGRlbHRhCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5nZXRUaXRsZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciB0aXRsZQogICAgdmFyICRlID0gdGhpcy4kZWxlbWVudAogICAgdmFyIG8gID0gdGhpcy5vcHRpb25zCgogICAgdGl0bGUgPSAkZS5hdHRyKCdkYXRhLW9yaWdpbmFsLXRpdGxlJykKICAgICAgfHwgKHR5cGVvZiBvLnRpdGxlID09ICdmdW5jdGlvbicgPyBvLnRpdGxlLmNhbGwoJGVbMF0pIDogIG8udGl0bGUpCgogICAgcmV0dXJuIHRpdGxlCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5nZXRVSUQgPSBmdW5jdGlvbiAocHJlZml4KSB7CiAgICBkbyBwcmVmaXggKz0gfn4oTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApCiAgICB3aGlsZSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocHJlZml4KSkKICAgIHJldHVybiBwcmVmaXgKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLnRpcCA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy4kdGlwKSB7CiAgICAgIHRoaXMuJHRpcCA9ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlKQogICAgICBpZiAodGhpcy4kdGlwLmxlbmd0aCAhPSAxKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMudHlwZSArICcgYHRlbXBsYXRlYCBvcHRpb24gbXVzdCBjb25zaXN0IG9mIGV4YWN0bHkgMSB0b3AtbGV2ZWwgZWxlbWVudCEnKQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy4kdGlwCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5hcnJvdyA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAodGhpcy4kYXJyb3cgPSB0aGlzLiRhcnJvdyB8fCB0aGlzLnRpcCgpLmZpbmQoJy50b29sdGlwLWFycm93JykpCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVuYWJsZWQgPSB0cnVlCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbmFibGVkID0gZmFsc2UKICB9CgogIFRvb2x0aXAucHJvdG90eXBlLnRvZ2dsZUVuYWJsZWQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVuYWJsZWQgPSAhdGhpcy5lbmFibGVkCiAgfQoKICBUb29sdGlwLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoZSkgewogICAgdmFyIHNlbGYgPSB0aGlzCiAgICBpZiAoZSkgewogICAgICBzZWxmID0gJChlLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUpCiAgICAgIGlmICghc2VsZikgewogICAgICAgIHNlbGYgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihlLmN1cnJlbnRUYXJnZXQsIHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpCiAgICAgICAgJChlLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUsIHNlbGYpCiAgICAgIH0KICAgIH0KCiAgICBpZiAoZSkgewogICAgICBzZWxmLmluU3RhdGUuY2xpY2sgPSAhc2VsZi5pblN0YXRlLmNsaWNrCiAgICAgIGlmIChzZWxmLmlzSW5TdGF0ZVRydWUoKSkgc2VsZi5lbnRlcihzZWxmKQogICAgICBlbHNlIHNlbGYubGVhdmUoc2VsZikKICAgIH0gZWxzZSB7CiAgICAgIHNlbGYudGlwKCkuaGFzQ2xhc3MoJ2luJykgPyBzZWxmLmxlYXZlKHNlbGYpIDogc2VsZi5lbnRlcihzZWxmKQogICAgfQogIH0KCiAgVG9vbHRpcC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciB0aGF0ID0gdGhpcwogICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCkKICAgIHRoaXMuaGlkZShmdW5jdGlvbiAoKSB7CiAgICAgIHRoYXQuJGVsZW1lbnQub2ZmKCcuJyArIHRoYXQudHlwZSkucmVtb3ZlRGF0YSgnYnMuJyArIHRoYXQudHlwZSkKICAgICAgaWYgKHRoYXQuJHRpcCkgewogICAgICAgIHRoYXQuJHRpcC5kZXRhY2goKQogICAgICB9CiAgICAgIHRoYXQuJHRpcCA9IG51bGwKICAgICAgdGhhdC4kYXJyb3cgPSBudWxsCiAgICAgIHRoYXQuJHZpZXdwb3J0ID0gbnVsbAogICAgfSkKICB9CgoKICAvLyBUT09MVElQIFBMVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PQoKICBmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICR0aGlzICAgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhICAgID0gJHRoaXMuZGF0YSgnYnMudG9vbHRpcCcpCiAgICAgIHZhciBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24KCiAgICAgIGlmICghZGF0YSAmJiAvZGVzdHJveXxoaWRlLy50ZXN0KG9wdGlvbikpIHJldHVybgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLnRvb2x0aXAnLCAoZGF0YSA9IG5ldyBUb29sdGlwKHRoaXMsIG9wdGlvbnMpKSkKICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpCiAgICB9KQogIH0KCiAgdmFyIG9sZCA9ICQuZm4udG9vbHRpcAoKICAkLmZuLnRvb2x0aXAgICAgICAgICAgICAgPSBQbHVnaW4KICAkLmZuLnRvb2x0aXAuQ29uc3RydWN0b3IgPSBUb29sdGlwCgoKICAvLyBUT09MVElQIE5PIENPTkZMSUNUCiAgLy8gPT09PT09PT09PT09PT09PT09PQoKICAkLmZuLnRvb2x0aXAubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQuZm4udG9vbHRpcCA9IG9sZAogICAgcmV0dXJuIHRoaXMKICB9Cgp9KGpRdWVyeSk7CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQm9vdHN0cmFwOiBwb3BvdmVyLmpzIHYzLjMuNQogKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNwb3BvdmVycwogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQ29weXJpZ2h0IDIwMTEtMjAxNSBUd2l0dGVyLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKCitmdW5jdGlvbiAoJCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLy8gUE9QT1ZFUiBQVUJMSUMgQ0xBU1MgREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgdmFyIFBvcG92ZXIgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykgewogICAgdGhpcy5pbml0KCdwb3BvdmVyJywgZWxlbWVudCwgb3B0aW9ucykKICB9CgogIGlmICghJC5mbi50b29sdGlwKSB0aHJvdyBuZXcgRXJyb3IoJ1BvcG92ZXIgcmVxdWlyZXMgdG9vbHRpcC5qcycpCgogIFBvcG92ZXIuVkVSU0lPTiAgPSAnMy4zLjUnCgogIFBvcG92ZXIuREVGQVVMVFMgPSAkLmV4dGVuZCh7fSwgJC5mbi50b29sdGlwLkNvbnN0cnVjdG9yLkRFRkFVTFRTLCB7CiAgICBwbGFjZW1lbnQ6ICdyaWdodCcsCiAgICB0cmlnZ2VyOiAnY2xpY2snLAogICAgY29udGVudDogJycsCiAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9InBvcG92ZXIiIHJvbGU9InRvb2x0aXAiPjxkaXYgY2xhc3M9ImFycm93Ij48L2Rpdj48aDMgY2xhc3M9InBvcG92ZXItdGl0bGUiPjwvaDM+PGRpdiBjbGFzcz0icG9wb3Zlci1jb250ZW50Ij48L2Rpdj48L2Rpdj4nCiAgfSkKCgogIC8vIE5PVEU6IFBPUE9WRVIgRVhURU5EUyB0b29sdGlwLmpzCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgUG9wb3Zlci5wcm90b3R5cGUgPSAkLmV4dGVuZCh7fSwgJC5mbi50b29sdGlwLkNvbnN0cnVjdG9yLnByb3RvdHlwZSkKCiAgUG9wb3Zlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQb3BvdmVyCgogIFBvcG92ZXIucHJvdG90eXBlLmdldERlZmF1bHRzID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFBvcG92ZXIuREVGQVVMVFMKICB9CgogIFBvcG92ZXIucHJvdG90eXBlLnNldENvbnRlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgJHRpcCAgICA9IHRoaXMudGlwKCkKICAgIHZhciB0aXRsZSAgID0gdGhpcy5nZXRUaXRsZSgpCiAgICB2YXIgY29udGVudCA9IHRoaXMuZ2V0Q29udGVudCgpCgogICAgJHRpcC5maW5kKCcucG9wb3Zlci10aXRsZScpW3RoaXMub3B0aW9ucy5odG1sID8gJ2h0bWwnIDogJ3RleHQnXSh0aXRsZSkKICAgICR0aXAuZmluZCgnLnBvcG92ZXItY29udGVudCcpLmNoaWxkcmVuKCkuZGV0YWNoKCkuZW5kKClbIC8vIHdlIHVzZSBhcHBlbmQgZm9yIGh0bWwgb2JqZWN0cyB0byBtYWludGFpbiBqcyBldmVudHMKICAgICAgdGhpcy5vcHRpb25zLmh0bWwgPyAodHlwZW9mIGNvbnRlbnQgPT0gJ3N0cmluZycgPyAnaHRtbCcgOiAnYXBwZW5kJykgOiAndGV4dCcKICAgIF0oY29udGVudCkKCiAgICAkdGlwLnJlbW92ZUNsYXNzKCdmYWRlIHRvcCBib3R0b20gbGVmdCByaWdodCBpbicpCgogICAgLy8gSUU4IGRvZXNuJ3QgYWNjZXB0IGhpZGluZyB2aWEgdGhlIGA6ZW1wdHlgIHBzZXVkbyBzZWxlY3Rvciwgd2UgaGF2ZSB0byBkbwogICAgLy8gdGhpcyBtYW51YWxseSBieSBjaGVja2luZyB0aGUgY29udGVudHMuCiAgICBpZiAoISR0aXAuZmluZCgnLnBvcG92ZXItdGl0bGUnKS5odG1sKCkpICR0aXAuZmluZCgnLnBvcG92ZXItdGl0bGUnKS5oaWRlKCkKICB9CgogIFBvcG92ZXIucHJvdG90eXBlLmhhc0NvbnRlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5nZXRUaXRsZSgpIHx8IHRoaXMuZ2V0Q29udGVudCgpCiAgfQoKICBQb3BvdmVyLnByb3RvdHlwZS5nZXRDb250ZW50ID0gZnVuY3Rpb24gKCkgewogICAgdmFyICRlID0gdGhpcy4kZWxlbWVudAogICAgdmFyIG8gID0gdGhpcy5vcHRpb25zCgogICAgcmV0dXJuICRlLmF0dHIoJ2RhdGEtY29udGVudCcpCiAgICAgIHx8ICh0eXBlb2Ygby5jb250ZW50ID09ICdmdW5jdGlvbicgPwogICAgICAgICAgICBvLmNvbnRlbnQuY2FsbCgkZVswXSkgOgogICAgICAgICAgICBvLmNvbnRlbnQpCiAgfQoKICBQb3BvdmVyLnByb3RvdHlwZS5hcnJvdyA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAodGhpcy4kYXJyb3cgPSB0aGlzLiRhcnJvdyB8fCB0aGlzLnRpcCgpLmZpbmQoJy5hcnJvdycpKQogIH0KCgogIC8vIFBPUE9WRVIgUExVR0lOIERFRklOSVRJT04KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHRoaXMgICA9ICQodGhpcykKICAgICAgdmFyIGRhdGEgICAgPSAkdGhpcy5kYXRhKCdicy5wb3BvdmVyJykKICAgICAgdmFyIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbgoKICAgICAgaWYgKCFkYXRhICYmIC9kZXN0cm95fGhpZGUvLnRlc3Qob3B0aW9uKSkgcmV0dXJuCiAgICAgIGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMucG9wb3ZlcicsIChkYXRhID0gbmV3IFBvcG92ZXIodGhpcywgb3B0aW9ucykpKQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkKICAgIH0pCiAgfQoKICB2YXIgb2xkID0gJC5mbi5wb3BvdmVyCgogICQuZm4ucG9wb3ZlciAgICAgICAgICAgICA9IFBsdWdpbgogICQuZm4ucG9wb3Zlci5Db25zdHJ1Y3RvciA9IFBvcG92ZXIKCgogIC8vIFBPUE9WRVIgTk8gQ09ORkxJQ1QKICAvLyA9PT09PT09PT09PT09PT09PT09CgogICQuZm4ucG9wb3Zlci5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbi5wb3BvdmVyID0gb2xkCiAgICByZXR1cm4gdGhpcwogIH0KCn0oalF1ZXJ5KTsKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBCb290c3RyYXA6IHNjcm9sbHNweS5qcyB2My4zLjUKICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jc2Nyb2xsc3B5CiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKiBDb3B5cmlnaHQgMjAxMS0yMDE1IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgoKK2Z1bmN0aW9uICgkKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBTQ1JPTExTUFkgQ0xBU1MgREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9uIFNjcm9sbFNweShlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0aGlzLiRib2R5ICAgICAgICAgID0gJChkb2N1bWVudC5ib2R5KQogICAgdGhpcy4kc2Nyb2xsRWxlbWVudCA9ICQoZWxlbWVudCkuaXMoZG9jdW1lbnQuYm9keSkgPyAkKHdpbmRvdykgOiAkKGVsZW1lbnQpCiAgICB0aGlzLm9wdGlvbnMgICAgICAgID0gJC5leHRlbmQoe30sIFNjcm9sbFNweS5ERUZBVUxUUywgb3B0aW9ucykKICAgIHRoaXMuc2VsZWN0b3IgICAgICAgPSAodGhpcy5vcHRpb25zLnRhcmdldCB8fCAnJykgKyAnIC5uYXYgbGkgPiBhJwogICAgdGhpcy5vZmZzZXRzICAgICAgICA9IFtdCiAgICB0aGlzLnRhcmdldHMgICAgICAgID0gW10KICAgIHRoaXMuYWN0aXZlVGFyZ2V0ICAgPSBudWxsCiAgICB0aGlzLnNjcm9sbEhlaWdodCAgID0gMAoKICAgIHRoaXMuJHNjcm9sbEVsZW1lbnQub24oJ3Njcm9sbC5icy5zY3JvbGxzcHknLCAkLnByb3h5KHRoaXMucHJvY2VzcywgdGhpcykpCiAgICB0aGlzLnJlZnJlc2goKQogICAgdGhpcy5wcm9jZXNzKCkKICB9CgogIFNjcm9sbFNweS5WRVJTSU9OICA9ICczLjMuNScKCiAgU2Nyb2xsU3B5LkRFRkFVTFRTID0gewogICAgb2Zmc2V0OiAxMAogIH0KCiAgU2Nyb2xsU3B5LnByb3RvdHlwZS5nZXRTY3JvbGxIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy4kc2Nyb2xsRWxlbWVudFswXS5zY3JvbGxIZWlnaHQgfHwgTWF0aC5tYXgodGhpcy4kYm9keVswXS5zY3JvbGxIZWlnaHQsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQpCiAgfQoKICBTY3JvbGxTcHkucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgdGhhdCAgICAgICAgICA9IHRoaXMKICAgIHZhciBvZmZzZXRNZXRob2QgID0gJ29mZnNldCcKICAgIHZhciBvZmZzZXRCYXNlICAgID0gMAoKICAgIHRoaXMub2Zmc2V0cyAgICAgID0gW10KICAgIHRoaXMudGFyZ2V0cyAgICAgID0gW10KICAgIHRoaXMuc2Nyb2xsSGVpZ2h0ID0gdGhpcy5nZXRTY3JvbGxIZWlnaHQoKQoKICAgIGlmICghJC5pc1dpbmRvdyh0aGlzLiRzY3JvbGxFbGVtZW50WzBdKSkgewogICAgICBvZmZzZXRNZXRob2QgPSAncG9zaXRpb24nCiAgICAgIG9mZnNldEJhc2UgICA9IHRoaXMuJHNjcm9sbEVsZW1lbnQuc2Nyb2xsVG9wKCkKICAgIH0KCiAgICB0aGlzLiRib2R5CiAgICAgIC5maW5kKHRoaXMuc2VsZWN0b3IpCiAgICAgIC5tYXAoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciAkZWwgICA9ICQodGhpcykKICAgICAgICB2YXIgaHJlZiAgPSAkZWwuZGF0YSgndGFyZ2V0JykgfHwgJGVsLmF0dHIoJ2hyZWYnKQogICAgICAgIHZhciAkaHJlZiA9IC9eIy4vLnRlc3QoaHJlZikgJiYgJChocmVmKQoKICAgICAgICByZXR1cm4gKCRocmVmCiAgICAgICAgICAmJiAkaHJlZi5sZW5ndGgKICAgICAgICAgICYmICRocmVmLmlzKCc6dmlzaWJsZScpCiAgICAgICAgICAmJiBbWyRocmVmW29mZnNldE1ldGhvZF0oKS50b3AgKyBvZmZzZXRCYXNlLCBocmVmXV0pIHx8IG51bGwKICAgICAgfSkKICAgICAgLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGFbMF0gLSBiWzBdIH0pCiAgICAgIC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGF0Lm9mZnNldHMucHVzaCh0aGlzWzBdKQogICAgICAgIHRoYXQudGFyZ2V0cy5wdXNoKHRoaXNbMV0pCiAgICAgIH0pCiAgfQoKICBTY3JvbGxTcHkucHJvdG90eXBlLnByb2Nlc3MgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2Nyb2xsVG9wICAgID0gdGhpcy4kc2Nyb2xsRWxlbWVudC5zY3JvbGxUb3AoKSArIHRoaXMub3B0aW9ucy5vZmZzZXQKICAgIHZhciBzY3JvbGxIZWlnaHQgPSB0aGlzLmdldFNjcm9sbEhlaWdodCgpCiAgICB2YXIgbWF4U2Nyb2xsICAgID0gdGhpcy5vcHRpb25zLm9mZnNldCArIHNjcm9sbEhlaWdodCAtIHRoaXMuJHNjcm9sbEVsZW1lbnQuaGVpZ2h0KCkKICAgIHZhciBvZmZzZXRzICAgICAgPSB0aGlzLm9mZnNldHMKICAgIHZhciB0YXJnZXRzICAgICAgPSB0aGlzLnRhcmdldHMKICAgIHZhciBhY3RpdmVUYXJnZXQgPSB0aGlzLmFjdGl2ZVRhcmdldAogICAgdmFyIGkKCiAgICBpZiAodGhpcy5zY3JvbGxIZWlnaHQgIT0gc2Nyb2xsSGVpZ2h0KSB7CiAgICAgIHRoaXMucmVmcmVzaCgpCiAgICB9CgogICAgaWYgKHNjcm9sbFRvcCA+PSBtYXhTY3JvbGwpIHsKICAgICAgcmV0dXJuIGFjdGl2ZVRhcmdldCAhPSAoaSA9IHRhcmdldHNbdGFyZ2V0cy5sZW5ndGggLSAxXSkgJiYgdGhpcy5hY3RpdmF0ZShpKQogICAgfQoKICAgIGlmIChhY3RpdmVUYXJnZXQgJiYgc2Nyb2xsVG9wIDwgb2Zmc2V0c1swXSkgewogICAgICB0aGlzLmFjdGl2ZVRhcmdldCA9IG51bGwKICAgICAgcmV0dXJuIHRoaXMuY2xlYXIoKQogICAgfQoKICAgIGZvciAoaSA9IG9mZnNldHMubGVuZ3RoOyBpLS07KSB7CiAgICAgIGFjdGl2ZVRhcmdldCAhPSB0YXJnZXRzW2ldCiAgICAgICAgJiYgc2Nyb2xsVG9wID49IG9mZnNldHNbaV0KICAgICAgICAmJiAob2Zmc2V0c1tpICsgMV0gPT09IHVuZGVmaW5lZCB8fCBzY3JvbGxUb3AgPCBvZmZzZXRzW2kgKyAxXSkKICAgICAgICAmJiB0aGlzLmFjdGl2YXRlKHRhcmdldHNbaV0pCiAgICB9CiAgfQoKICBTY3JvbGxTcHkucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24gKHRhcmdldCkgewogICAgdGhpcy5hY3RpdmVUYXJnZXQgPSB0YXJnZXQKCiAgICB0aGlzLmNsZWFyKCkKCiAgICB2YXIgc2VsZWN0b3IgPSB0aGlzLnNlbGVjdG9yICsKICAgICAgJ1tkYXRhLXRhcmdldD0iJyArIHRhcmdldCArICciXSwnICsKICAgICAgdGhpcy5zZWxlY3RvciArICdbaHJlZj0iJyArIHRhcmdldCArICciXScKCiAgICB2YXIgYWN0aXZlID0gJChzZWxlY3RvcikKICAgICAgLnBhcmVudHMoJ2xpJykKICAgICAgLmFkZENsYXNzKCdhY3RpdmUnKQoKICAgIGlmIChhY3RpdmUucGFyZW50KCcuZHJvcGRvd24tbWVudScpLmxlbmd0aCkgewogICAgICBhY3RpdmUgPSBhY3RpdmUKICAgICAgICAuY2xvc2VzdCgnbGkuZHJvcGRvd24nKQogICAgICAgIC5hZGRDbGFzcygnYWN0aXZlJykKICAgIH0KCiAgICBhY3RpdmUudHJpZ2dlcignYWN0aXZhdGUuYnMuc2Nyb2xsc3B5JykKICB9CgogIFNjcm9sbFNweS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAkKHRoaXMuc2VsZWN0b3IpCiAgICAgIC5wYXJlbnRzVW50aWwodGhpcy5vcHRpb25zLnRhcmdldCwgJy5hY3RpdmUnKQogICAgICAucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpCiAgfQoKCiAgLy8gU0NST0xMU1BZIFBMVUdJTiBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09CgogIGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHRoaXMgICA9ICQodGhpcykKICAgICAgdmFyIGRhdGEgICAgPSAkdGhpcy5kYXRhKCdicy5zY3JvbGxzcHknKQogICAgICB2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uCgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLnNjcm9sbHNweScsIChkYXRhID0gbmV3IFNjcm9sbFNweSh0aGlzLCBvcHRpb25zKSkpCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKQogICAgfSkKICB9CgogIHZhciBvbGQgPSAkLmZuLnNjcm9sbHNweQoKICAkLmZuLnNjcm9sbHNweSAgICAgICAgICAgICA9IFBsdWdpbgogICQuZm4uc2Nyb2xsc3B5LkNvbnN0cnVjdG9yID0gU2Nyb2xsU3B5CgoKICAvLyBTQ1JPTExTUFkgTk8gQ09ORkxJQ1QKICAvLyA9PT09PT09PT09PT09PT09PT09PT0KCiAgJC5mbi5zY3JvbGxzcHkubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQuZm4uc2Nyb2xsc3B5ID0gb2xkCiAgICByZXR1cm4gdGhpcwogIH0KCgogIC8vIFNDUk9MTFNQWSBEQVRBLUFQSQogIC8vID09PT09PT09PT09PT09PT09PQoKICAkKHdpbmRvdykub24oJ2xvYWQuYnMuc2Nyb2xsc3B5LmRhdGEtYXBpJywgZnVuY3Rpb24gKCkgewogICAgJCgnW2RhdGEtc3B5PSJzY3JvbGwiXScpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHNweSA9ICQodGhpcykKICAgICAgUGx1Z2luLmNhbGwoJHNweSwgJHNweS5kYXRhKCkpCiAgICB9KQogIH0pCgp9KGpRdWVyeSk7CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQm9vdHN0cmFwOiB0YWIuanMgdjMuMy41CiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI3RhYnMKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvcHlyaWdodCAyMDExLTIwMTUgVHdpdHRlciwgSW5jLgogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIFRBQiBDTEFTUyBERUZJTklUSU9OCiAgLy8gPT09PT09PT09PT09PT09PT09PT0KCiAgdmFyIFRhYiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAvLyBqc2NzOmRpc2FibGUgcmVxdWlyZURvbGxhckJlZm9yZWpRdWVyeUFzc2lnbm1lbnQKICAgIHRoaXMuZWxlbWVudCA9ICQoZWxlbWVudCkKICAgIC8vIGpzY3M6ZW5hYmxlIHJlcXVpcmVEb2xsYXJCZWZvcmVqUXVlcnlBc3NpZ25tZW50CiAgfQoKICBUYWIuVkVSU0lPTiA9ICczLjMuNScKCiAgVGFiLlRSQU5TSVRJT05fRFVSQVRJT04gPSAxNTAKCiAgVGFiLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkgewogICAgdmFyICR0aGlzICAgID0gdGhpcy5lbGVtZW50CiAgICB2YXIgJHVsICAgICAgPSAkdGhpcy5jbG9zZXN0KCd1bDpub3QoLmRyb3Bkb3duLW1lbnUpJykKICAgIHZhciBzZWxlY3RvciA9ICR0aGlzLmRhdGEoJ3RhcmdldCcpCgogICAgaWYgKCFzZWxlY3RvcikgewogICAgICBzZWxlY3RvciA9ICR0aGlzLmF0dHIoJ2hyZWYnKQogICAgICBzZWxlY3RvciA9IHNlbGVjdG9yICYmIHNlbGVjdG9yLnJlcGxhY2UoLy4qKD89I1teXHNdKiQpLywgJycpIC8vIHN0cmlwIGZvciBpZTcKICAgIH0KCiAgICBpZiAoJHRoaXMucGFyZW50KCdsaScpLmhhc0NsYXNzKCdhY3RpdmUnKSkgcmV0dXJuCgogICAgdmFyICRwcmV2aW91cyA9ICR1bC5maW5kKCcuYWN0aXZlOmxhc3QgYScpCiAgICB2YXIgaGlkZUV2ZW50ID0gJC5FdmVudCgnaGlkZS5icy50YWInLCB7CiAgICAgIHJlbGF0ZWRUYXJnZXQ6ICR0aGlzWzBdCiAgICB9KQogICAgdmFyIHNob3dFdmVudCA9ICQuRXZlbnQoJ3Nob3cuYnMudGFiJywgewogICAgICByZWxhdGVkVGFyZ2V0OiAkcHJldmlvdXNbMF0KICAgIH0pCgogICAgJHByZXZpb3VzLnRyaWdnZXIoaGlkZUV2ZW50KQogICAgJHRoaXMudHJpZ2dlcihzaG93RXZlbnQpCgogICAgaWYgKHNob3dFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSB8fCBoaWRlRXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybgoKICAgIHZhciAkdGFyZ2V0ID0gJChzZWxlY3RvcikKCiAgICB0aGlzLmFjdGl2YXRlKCR0aGlzLmNsb3Nlc3QoJ2xpJyksICR1bCkKICAgIHRoaXMuYWN0aXZhdGUoJHRhcmdldCwgJHRhcmdldC5wYXJlbnQoKSwgZnVuY3Rpb24gKCkgewogICAgICAkcHJldmlvdXMudHJpZ2dlcih7CiAgICAgICAgdHlwZTogJ2hpZGRlbi5icy50YWInLAogICAgICAgIHJlbGF0ZWRUYXJnZXQ6ICR0aGlzWzBdCiAgICAgIH0pCiAgICAgICR0aGlzLnRyaWdnZXIoewogICAgICAgIHR5cGU6ICdzaG93bi5icy50YWInLAogICAgICAgIHJlbGF0ZWRUYXJnZXQ6ICRwcmV2aW91c1swXQogICAgICB9KQogICAgfSkKICB9CgogIFRhYi5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiAoZWxlbWVudCwgY29udGFpbmVyLCBjYWxsYmFjaykgewogICAgdmFyICRhY3RpdmUgICAgPSBjb250YWluZXIuZmluZCgnPiAuYWN0aXZlJykKICAgIHZhciB0cmFuc2l0aW9uID0gY2FsbGJhY2sKICAgICAgJiYgJC5zdXBwb3J0LnRyYW5zaXRpb24KICAgICAgJiYgKCRhY3RpdmUubGVuZ3RoICYmICRhY3RpdmUuaGFzQ2xhc3MoJ2ZhZGUnKSB8fCAhIWNvbnRhaW5lci5maW5kKCc+IC5mYWRlJykubGVuZ3RoKQoKICAgIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICRhY3RpdmUKICAgICAgICAucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpCiAgICAgICAgLmZpbmQoJz4gLmRyb3Bkb3duLW1lbnUgPiAuYWN0aXZlJykKICAgICAgICAgIC5yZW1vdmVDbGFzcygnYWN0aXZlJykKICAgICAgICAuZW5kKCkKICAgICAgICAuZmluZCgnW2RhdGEtdG9nZ2xlPSJ0YWIiXScpCiAgICAgICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsIGZhbHNlKQoKICAgICAgZWxlbWVudAogICAgICAgIC5hZGRDbGFzcygnYWN0aXZlJykKICAgICAgICAuZmluZCgnW2RhdGEtdG9nZ2xlPSJ0YWIiXScpCiAgICAgICAgICAuYXR0cignYXJpYS1leHBhbmRlZCcsIHRydWUpCgogICAgICBpZiAodHJhbnNpdGlvbikgewogICAgICAgIGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGggLy8gcmVmbG93IGZvciB0cmFuc2l0aW9uCiAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnaW4nKQogICAgICB9IGVsc2UgewogICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZhZGUnKQogICAgICB9CgogICAgICBpZiAoZWxlbWVudC5wYXJlbnQoJy5kcm9wZG93bi1tZW51JykubGVuZ3RoKSB7CiAgICAgICAgZWxlbWVudAogICAgICAgICAgLmNsb3Nlc3QoJ2xpLmRyb3Bkb3duJykKICAgICAgICAgICAgLmFkZENsYXNzKCdhY3RpdmUnKQogICAgICAgICAgLmVuZCgpCiAgICAgICAgICAuZmluZCgnW2RhdGEtdG9nZ2xlPSJ0YWIiXScpCiAgICAgICAgICAgIC5hdHRyKCdhcmlhLWV4cGFuZGVkJywgdHJ1ZSkKICAgICAgfQoKICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKQogICAgfQoKICAgICRhY3RpdmUubGVuZ3RoICYmIHRyYW5zaXRpb24gPwogICAgICAkYWN0aXZlCiAgICAgICAgLm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgbmV4dCkKICAgICAgICAuZW11bGF0ZVRyYW5zaXRpb25FbmQoVGFiLlRSQU5TSVRJT05fRFVSQVRJT04pIDoKICAgICAgbmV4dCgpCgogICAgJGFjdGl2ZS5yZW1vdmVDbGFzcygnaW4nKQogIH0KCgogIC8vIFRBQiBQTFVHSU4gREVGSU5JVElPTgogIC8vID09PT09PT09PT09PT09PT09PT09PQoKICBmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICR0aGlzID0gJCh0aGlzKQogICAgICB2YXIgZGF0YSAgPSAkdGhpcy5kYXRhKCdicy50YWInKQoKICAgICAgaWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy50YWInLCAoZGF0YSA9IG5ldyBUYWIodGhpcykpKQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkKICAgIH0pCiAgfQoKICB2YXIgb2xkID0gJC5mbi50YWIKCiAgJC5mbi50YWIgICAgICAgICAgICAgPSBQbHVnaW4KICAkLmZuLnRhYi5Db25zdHJ1Y3RvciA9IFRhYgoKCiAgLy8gVEFCIE5PIENPTkZMSUNUCiAgLy8gPT09PT09PT09PT09PT09CgogICQuZm4udGFiLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmZuLnRhYiA9IG9sZAogICAgcmV0dXJuIHRoaXMKICB9CgoKICAvLyBUQUIgREFUQS1BUEkKICAvLyA9PT09PT09PT09PT0KCiAgdmFyIGNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7CiAgICBlLnByZXZlbnREZWZhdWx0KCkKICAgIFBsdWdpbi5jYWxsKCQodGhpcyksICdzaG93JykKICB9CgogICQoZG9jdW1lbnQpCiAgICAub24oJ2NsaWNrLmJzLnRhYi5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9InRhYiJdJywgY2xpY2tIYW5kbGVyKQogICAgLm9uKCdjbGljay5icy50YWIuZGF0YS1hcGknLCAnW2RhdGEtdG9nZ2xlPSJwaWxsIl0nLCBjbGlja0hhbmRsZXIpCgp9KGpRdWVyeSk7CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICogQm9vdHN0cmFwOiBhZmZpeC5qcyB2My4zLjUKICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jYWZmaXgKICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqIENvcHlyaWdodCAyMDExLTIwMTUgVHdpdHRlciwgSW5jLgogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCgorZnVuY3Rpb24gKCQpIHsKICAndXNlIHN0cmljdCc7CgogIC8vIEFGRklYIENMQVNTIERFRklOSVRJT04KICAvLyA9PT09PT09PT09PT09PT09PT09PT09CgogIHZhciBBZmZpeCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQWZmaXguREVGQVVMVFMsIG9wdGlvbnMpCgogICAgdGhpcy4kdGFyZ2V0ID0gJCh0aGlzLm9wdGlvbnMudGFyZ2V0KQogICAgICAub24oJ3Njcm9sbC5icy5hZmZpeC5kYXRhLWFwaScsICQucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uLCB0aGlzKSkKICAgICAgLm9uKCdjbGljay5icy5hZmZpeC5kYXRhLWFwaScsICAkLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3AsIHRoaXMpKQoKICAgIHRoaXMuJGVsZW1lbnQgICAgID0gJChlbGVtZW50KQogICAgdGhpcy5hZmZpeGVkICAgICAgPSBudWxsCiAgICB0aGlzLnVucGluICAgICAgICA9IG51bGwKICAgIHRoaXMucGlubmVkT2Zmc2V0ID0gbnVsbAoKICAgIHRoaXMuY2hlY2tQb3NpdGlvbigpCiAgfQoKICBBZmZpeC5WRVJTSU9OICA9ICczLjMuNScKCiAgQWZmaXguUkVTRVQgICAgPSAnYWZmaXggYWZmaXgtdG9wIGFmZml4LWJvdHRvbScKCiAgQWZmaXguREVGQVVMVFMgPSB7CiAgICBvZmZzZXQ6IDAsCiAgICB0YXJnZXQ6IHdpbmRvdwogIH0KCiAgQWZmaXgucHJvdG90eXBlLmdldFN0YXRlID0gZnVuY3Rpb24gKHNjcm9sbEhlaWdodCwgaGVpZ2h0LCBvZmZzZXRUb3AsIG9mZnNldEJvdHRvbSkgewogICAgdmFyIHNjcm9sbFRvcCAgICA9IHRoaXMuJHRhcmdldC5zY3JvbGxUb3AoKQogICAgdmFyIHBvc2l0aW9uICAgICA9IHRoaXMuJGVsZW1lbnQub2Zmc2V0KCkKICAgIHZhciB0YXJnZXRIZWlnaHQgPSB0aGlzLiR0YXJnZXQuaGVpZ2h0KCkKCiAgICBpZiAob2Zmc2V0VG9wICE9IG51bGwgJiYgdGhpcy5hZmZpeGVkID09ICd0b3AnKSByZXR1cm4gc2Nyb2xsVG9wIDwgb2Zmc2V0VG9wID8gJ3RvcCcgOiBmYWxzZQoKICAgIGlmICh0aGlzLmFmZml4ZWQgPT0gJ2JvdHRvbScpIHsKICAgICAgaWYgKG9mZnNldFRvcCAhPSBudWxsKSByZXR1cm4gKHNjcm9sbFRvcCArIHRoaXMudW5waW4gPD0gcG9zaXRpb24udG9wKSA/IGZhbHNlIDogJ2JvdHRvbScKICAgICAgcmV0dXJuIChzY3JvbGxUb3AgKyB0YXJnZXRIZWlnaHQgPD0gc2Nyb2xsSGVpZ2h0IC0gb2Zmc2V0Qm90dG9tKSA/IGZhbHNlIDogJ2JvdHRvbScKICAgIH0KCiAgICB2YXIgaW5pdGlhbGl6aW5nICAgPSB0aGlzLmFmZml4ZWQgPT0gbnVsbAogICAgdmFyIGNvbGxpZGVyVG9wICAgID0gaW5pdGlhbGl6aW5nID8gc2Nyb2xsVG9wIDogcG9zaXRpb24udG9wCiAgICB2YXIgY29sbGlkZXJIZWlnaHQgPSBpbml0aWFsaXppbmcgPyB0YXJnZXRIZWlnaHQgOiBoZWlnaHQKCiAgICBpZiAob2Zmc2V0VG9wICE9IG51bGwgJiYgc2Nyb2xsVG9wIDw9IG9mZnNldFRvcCkgcmV0dXJuICd0b3AnCiAgICBpZiAob2Zmc2V0Qm90dG9tICE9IG51bGwgJiYgKGNvbGxpZGVyVG9wICsgY29sbGlkZXJIZWlnaHQgPj0gc2Nyb2xsSGVpZ2h0IC0gb2Zmc2V0Qm90dG9tKSkgcmV0dXJuICdib3R0b20nCgogICAgcmV0dXJuIGZhbHNlCiAgfQoKICBBZmZpeC5wcm90b3R5cGUuZ2V0UGlubmVkT2Zmc2V0ID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMucGlubmVkT2Zmc2V0KSByZXR1cm4gdGhpcy5waW5uZWRPZmZzZXQKICAgIHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoQWZmaXguUkVTRVQpLmFkZENsYXNzKCdhZmZpeCcpCiAgICB2YXIgc2Nyb2xsVG9wID0gdGhpcy4kdGFyZ2V0LnNjcm9sbFRvcCgpCiAgICB2YXIgcG9zaXRpb24gID0gdGhpcy4kZWxlbWVudC5vZmZzZXQoKQogICAgcmV0dXJuICh0aGlzLnBpbm5lZE9mZnNldCA9IHBvc2l0aW9uLnRvcCAtIHNjcm9sbFRvcCkKICB9CgogIEFmZml4LnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uV2l0aEV2ZW50TG9vcCA9IGZ1bmN0aW9uICgpIHsKICAgIHNldFRpbWVvdXQoJC5wcm94eSh0aGlzLmNoZWNrUG9zaXRpb24sIHRoaXMpLCAxKQogIH0KCiAgQWZmaXgucHJvdG90eXBlLmNoZWNrUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMuJGVsZW1lbnQuaXMoJzp2aXNpYmxlJykpIHJldHVybgoKICAgIHZhciBoZWlnaHQgICAgICAgPSB0aGlzLiRlbGVtZW50LmhlaWdodCgpCiAgICB2YXIgb2Zmc2V0ICAgICAgID0gdGhpcy5vcHRpb25zLm9mZnNldAogICAgdmFyIG9mZnNldFRvcCAgICA9IG9mZnNldC50b3AKICAgIHZhciBvZmZzZXRCb3R0b20gPSBvZmZzZXQuYm90dG9tCiAgICB2YXIgc2Nyb2xsSGVpZ2h0ID0gTWF0aC5tYXgoJChkb2N1bWVudCkuaGVpZ2h0KCksICQoZG9jdW1lbnQuYm9keSkuaGVpZ2h0KCkpCgogICAgaWYgKHR5cGVvZiBvZmZzZXQgIT0gJ29iamVjdCcpICAgICAgICAgb2Zmc2V0Qm90dG9tID0gb2Zmc2V0VG9wID0gb2Zmc2V0CiAgICBpZiAodHlwZW9mIG9mZnNldFRvcCA9PSAnZnVuY3Rpb24nKSAgICBvZmZzZXRUb3AgICAgPSBvZmZzZXQudG9wKHRoaXMuJGVsZW1lbnQpCiAgICBpZiAodHlwZW9mIG9mZnNldEJvdHRvbSA9PSAnZnVuY3Rpb24nKSBvZmZzZXRCb3R0b20gPSBvZmZzZXQuYm90dG9tKHRoaXMuJGVsZW1lbnQpCgogICAgdmFyIGFmZml4ID0gdGhpcy5nZXRTdGF0ZShzY3JvbGxIZWlnaHQsIGhlaWdodCwgb2Zmc2V0VG9wLCBvZmZzZXRCb3R0b20pCgogICAgaWYgKHRoaXMuYWZmaXhlZCAhPSBhZmZpeCkgewogICAgICBpZiAodGhpcy51bnBpbiAhPSBudWxsKSB0aGlzLiRlbGVtZW50LmNzcygndG9wJywgJycpCgogICAgICB2YXIgYWZmaXhUeXBlID0gJ2FmZml4JyArIChhZmZpeCA/ICctJyArIGFmZml4IDogJycpCiAgICAgIHZhciBlICAgICAgICAgPSAkLkV2ZW50KGFmZml4VHlwZSArICcuYnMuYWZmaXgnKQoKICAgICAgdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpCgogICAgICBpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuCgogICAgICB0aGlzLmFmZml4ZWQgPSBhZmZpeAogICAgICB0aGlzLnVucGluID0gYWZmaXggPT0gJ2JvdHRvbScgPyB0aGlzLmdldFBpbm5lZE9mZnNldCgpIDogbnVsbAoKICAgICAgdGhpcy4kZWxlbWVudAogICAgICAgIC5yZW1vdmVDbGFzcyhBZmZpeC5SRVNFVCkKICAgICAgICAuYWRkQ2xhc3MoYWZmaXhUeXBlKQogICAgICAgIC50cmlnZ2VyKGFmZml4VHlwZS5yZXBsYWNlKCdhZmZpeCcsICdhZmZpeGVkJykgKyAnLmJzLmFmZml4JykKICAgIH0KCiAgICBpZiAoYWZmaXggPT0gJ2JvdHRvbScpIHsKICAgICAgdGhpcy4kZWxlbWVudC5vZmZzZXQoewogICAgICAgIHRvcDogc2Nyb2xsSGVpZ2h0IC0gaGVpZ2h0IC0gb2Zmc2V0Qm90dG9tCiAgICAgIH0pCiAgICB9CiAgfQoKCiAgLy8gQUZGSVggUExVR0lOIERFRklOSVRJT04KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PQoKICBmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICR0aGlzICAgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhICAgID0gJHRoaXMuZGF0YSgnYnMuYWZmaXgnKQogICAgICB2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uCgogICAgICBpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLmFmZml4JywgKGRhdGEgPSBuZXcgQWZmaXgodGhpcywgb3B0aW9ucykpKQogICAgICBpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKCkKICAgIH0pCiAgfQoKICB2YXIgb2xkID0gJC5mbi5hZmZpeAoKICAkLmZuLmFmZml4ICAgICAgICAgICAgID0gUGx1Z2luCiAgJC5mbi5hZmZpeC5Db25zdHJ1Y3RvciA9IEFmZml4CgoKICAvLyBBRkZJWCBOTyBDT05GTElDVAogIC8vID09PT09PT09PT09PT09PT09CgogICQuZm4uYWZmaXgubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQuZm4uYWZmaXggPSBvbGQKICAgIHJldHVybiB0aGlzCiAgfQoKCiAgLy8gQUZGSVggREFUQS1BUEkKICAvLyA9PT09PT09PT09PT09PQoKICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAkKCdbZGF0YS1zcHk9ImFmZml4Il0nKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICRzcHkgPSAkKHRoaXMpCiAgICAgIHZhciBkYXRhID0gJHNweS5kYXRhKCkKCiAgICAgIGRhdGEub2Zmc2V0ID0gZGF0YS5vZmZzZXQgfHwge30KCiAgICAgIGlmIChkYXRhLm9mZnNldEJvdHRvbSAhPSBudWxsKSBkYXRhLm9mZnNldC5ib3R0b20gPSBkYXRhLm9mZnNldEJvdHRvbQogICAgICBpZiAoZGF0YS5vZmZzZXRUb3AgICAgIT0gbnVsbCkgZGF0YS5vZmZzZXQudG9wICAgID0gZGF0YS5vZmZzZXRUb3AKCiAgICAgIFBsdWdpbi5jYWxsKCRzcHksIGRhdGEpCiAgICB9KQogIH0pCgp9KGpRdWVyeSk7Cg=="></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('.btn-action').click(function() {

            });
        });
    </script>
</body>
</html>
